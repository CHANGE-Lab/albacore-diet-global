---
title: "Albacore Review Data Manipulation"
author: "Natasha Hardy"
date: "October 10, 2019"
output: html_document
---

## About

This document contains code for manipulating trait and diet datasets for albacore prey species from our global meta-analysis of albacore diet composition.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r Load Workspace, echo=FALSE, message=FALSE}

#R documentation
library(pander)
# general
library(tidyverse)
library(readxl)
library(readr)
library(plyr)
library(dplyr)
library(devtools)
library(here)
"%notin%" = Negate('%in%')
here::here()
#Graphics
library(graphics)
library(ggplot2)
library(RColorBrewer)
library(Hmisc)
library(lattice)
library(gridExtra)
library(captioner)
library(unmarked)
#Analyses
library(lme4)
library(mgcv)
library(mvabund)
library(tweedie)

```

## Trait Dataframes

### Prey morphometric measuremetns

We first want to load in and clean the prey morphometric measurements for adult taxa only, we did not finish or find many images to work with for juveniles or larvae of most species. The following code aims to:
*Check data & select relevant data,
*Calculate eye to body and body shape ratios, and
*Summarise to give an average value for each species for which we obtained images. We are able to obtain values for 293 species.

```{r Prey Morph Data Clean}

#Load prey morphometric measurement data

prey_morph = as.data.frame(read_xlsx(here("data/input_data/prey_morphometrics.xlsx"), 
                                                 sheet = "prey_adult_morphometrics"))
#Check dataframe
#str(prey_morph)

#Convert relevant columns to character/numeric values
#prey_morph[,12:17] <- sapply(prey_morph[,12:17], as.character)
prey_morph[,12:17] <- sapply(prey_morph[,12:17], as.numeric)

#Additional data checks
dim(prey_morph) #1290 rows and 21 columns
names(prey_morph)

#Data cleaning
#Note:
#This data still contains rows of NA's for juvenile and larval images that have not been scored yet, so we want to remove any NA values.
#We want just adults and mainly the values for body_shape_r & eye_body_r
prey_morph_clean = prey_morph %>%
  #dplyr::filter(life_stage == "adult") %>% #currently df already split by age group
  dplyr::filter(use %in% c("yes", "maybe")) %>% #c("no", "NA")
  #filter out everything but adult life_stage, filter out images that are use = "no"
  drop_na(t_length, b_height, eye_diameter) %>% #filter out any NA's in the desired columns
  mutate(b_shape_r = t_length/b_height, 
         eye_body_r = eye_diameter/t_length,
         standard_total = s_length/t_length)

str(prey_morph_clean)
#Note we have also added a conversion from standard length to total length (this can be used to convert lengths for SL/BL, ML/GL where we have them).
#These ratios are based on adults only.

```
