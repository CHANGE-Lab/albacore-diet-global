% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{article}
\usepackage{amsmath,amssymb}
\usepackage{lmodern}
\usepackage{ifxetex,ifluatex}
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  pdftitle={Albacore Diet Synthesis A - Phylo Graphs},
  pdfauthor={Natasha Hardy},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
\ifluatex
  \usepackage{selnolig}  % disable illegal ligatures
\fi

\title{Albacore Diet Synthesis A - Phylo Graphs}
\author{Natasha Hardy}
\date{15/04/2021}

\begin{document}
\maketitle

\hypertarget{set-up-your-working-environment}{%
\subsection{Set-up your working
environment}\label{set-up-your-working-environment}}

\textbf{Note:} Code issue has arisen discussed here:
\url{https://stackoverflow.com/questions/26619434/install-an-old-version-of-dplyr-0-12-in-r}
Here we will be updating some of the phylogenetic packages.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#Install packages if needed}

\CommentTok{\#remotes::install\_github("eliocamp/ggnewscale@dev")}

\CommentTok{\#remotes::install\_github("YuLab{-}SMU/ggtree")}

\CommentTok{\#if (!requireNamespace("BiocManager", quietly = TRUE))}
\CommentTok{\#    install.packages("BiocManager")}

\CommentTok{\#BiocManager::install("Biostrings")}
\CommentTok{\#BiocManager::install("ggtree")}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# general}
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(readxl)}
\FunctionTok{library}\NormalTok{(plyr)}
\FunctionTok{library}\NormalTok{(dplyr)}
\FunctionTok{library}\NormalTok{(devtools)}
\FunctionTok{library}\NormalTok{(here)}
\StringTok{"\%notin\%"} \OtherTok{=} \FunctionTok{Negate}\NormalTok{(}\StringTok{\textquotesingle{}\%in\%\textquotesingle{}}\NormalTok{)}
\NormalTok{here}\SpecialCharTok{::}\FunctionTok{here}\NormalTok{()}

\CommentTok{\# graphics}

\FunctionTok{library}\NormalTok{(ggplot2)}
\FunctionTok{library}\NormalTok{(lattice)}
\FunctionTok{library}\NormalTok{(graphics)}
\FunctionTok{library}\NormalTok{(ggnewscale)}
\FunctionTok{library}\NormalTok{(ggimage)}
\FunctionTok{library}\NormalTok{(reshape2)}
\FunctionTok{library}\NormalTok{(pander)}
\FunctionTok{library}\NormalTok{(gridExtra)}
\FunctionTok{library}\NormalTok{(captioner)}
\FunctionTok{library}\NormalTok{(unmarked)}
\FunctionTok{library}\NormalTok{(cowplot)}
\FunctionTok{library}\NormalTok{(gtable)}
\FunctionTok{library}\NormalTok{(viridis)}
\FunctionTok{library}\NormalTok{(PNWColors)}
\FunctionTok{library}\NormalTok{(RColorBrewer)}

\CommentTok{\# phylogenetic \& other tools}
\FunctionTok{library}\NormalTok{(ape)}
\FunctionTok{library}\NormalTok{(Biostrings)}
\FunctionTok{library}\NormalTok{(raster)}
\FunctionTok{library}\NormalTok{(dismo)}
\FunctionTok{library}\NormalTok{(patchwork)}
\FunctionTok{library}\NormalTok{(ggtree)}
\FunctionTok{library}\NormalTok{(ggstance)}
\FunctionTok{library}\NormalTok{(geiger)}
\FunctionTok{library}\NormalTok{(rotl) }\CommentTok{\#for phylogenetic analyses, get all the species? from Hinchliff et al. 2015 PNAS}
\FunctionTok{library}\NormalTok{(phylobase)}
\FunctionTok{library}\NormalTok{(phytools)}
\FunctionTok{library}\NormalTok{(phangorn)}
\FunctionTok{library}\NormalTok{(stringr)}
\FunctionTok{library}\NormalTok{(taxize)}
\FunctionTok{library}\NormalTok{(treeio)}
\end{Highlighting}
\end{Shaded}

\hypertarget{load-data}{%
\subsection{Load Data}\label{load-data}}

Using combination of my trial code and Matt Savoca and company's code to
build a phylo tree with associated trait and \%FO data

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#data contains sp list, class, order \& family + traits.}

\CommentTok{\#Probable life stage data}
\NormalTok{my\_prey\_prob }\OtherTok{=} \FunctionTok{read.csv}\NormalTok{(}\FunctionTok{here}\NormalTok{(}\StringTok{"./data/output\_data/prey\_probable\_traits.csv"}\NormalTok{), }\AttributeTok{header=}\ConstantTok{TRUE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(prey\_sp, prey\_class}\SpecialCharTok{:}\NormalTok{prey\_family, life\_stage, vert\_habitat}\SpecialCharTok{:}\NormalTok{maxM, }\SpecialCharTok{{-}}\NormalTok{X) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(prey\_sp }\SpecialCharTok{\%notin\%} \FunctionTok{c}\NormalTok{(}\StringTok{"Lampanyctus mexicanus"}\NormalTok{, }\StringTok{"Janthina exigua"}\NormalTok{))}
\CommentTok{\#298 species and 32 variables}
\FunctionTok{str}\NormalTok{(my\_prey\_prob)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 'data.frame':    298 obs. of  32 variables:
##  $ prey_sp           : chr  "Abralia redfieldi" "Abraliopsis affinis" "Abraliopsis felis" "Abraliopsis gilchristi" ...
##  $ prey_class        : chr  "Cephalopoda" "Cephalopoda" "Cephalopoda" "Cephalopoda" ...
##  $ prey_order        : chr  "Oegopsida" "Oegopsida" "Oegopsida" "Oegopsida" ...
##  $ prey_family       : chr  "Enoploteuthidae" "Enoploteuthidae" "Enoploteuthidae" "Enoploteuthidae" ...
##  $ life_stage        : chr  "adult" "adult" "adult" "adult" ...
##  $ vert_habitat      : chr  "mesopelagic" "mesopelagic" "mesopelagic" "mesopelagic" ...
##  $ horz_habitat      : chr  "oceanic" "oceanic" "oceanic" "continental slope" ...
##  $ diel_migrant      : int  1 1 1 1 1 1 1 NA 1 NA ...
##  $ diel_migrant_cat  : chr  "diel_yes" "diel_yes" "diel_yes" "diel_yes" ...
##  $ refuge            : int  0 0 0 0 0 0 0 0 1 0 ...
##  $ refuge_cat        : chr  "refuge_no" "refuge_no" "refuge_no" "refuge_no" ...
##  $ season_migrant    : int  NA NA NA NA NA 1 NA 1 0 NA ...
##  $ season_cat        : chr  "season_NA" "season_NA" "season_NA" "season_NA" ...
##  $ body_shape        : chr  "fusiform" "fusiform" "fusiform" "fusiform" ...
##  $ l_max             : num  3.6 4.3 8 5.1 3.5 27 NA 7.8 0.43 8.2 ...
##  $ phys_defense      : int  0 0 0 0 0 1 0 0 1 0 ...
##  $ transparent       : int  1 1 1 0 0 0 1 0 0 1 ...
##  $ col_disrupt       : int  1 1 1 0 0 0 0 1 0 0 ...
##  $ silver            : int  0 0 0 0 0 0 1 0 0 0 ...
##  $ countershade      : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ gregarious_primary: chr  NA NA NA NA ...
##  $ trophic_level     : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ fisheries_status  : chr  "none" "none" "none" "none" ...
##  $ b_shape_r         : num  3.91 5.35 5.28 5.63 8.39 ...
##  $ eye_body_r        : num  0.0849 0.0698 0.0508 0.0501 0.0421 ...
##  $ standard_total    : num  0.527 0.457 0.458 0.422 0.349 ...
##  $ energy_density    : num  NA NA 4.4 NA NA NA 1.7 3.9 NA NA ...
##  $ percent_protein   : num  NA NA 17.4 NA NA NA NA 16.4 NA NA ...
##  $ percent_lipid     : num  NA NA NA NA NA ...
##  $ maxFO             : num  5 1.16 36.4 0.7 4.9 ...
##  $ maxN              : num  0 0.0765 11.3 0.2 3.4 ...
##  $ maxM              : num  0 0.00609 2.13235 0.1 3.4 ...
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sapply}\NormalTok{(my\_prey\_prob, class)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##            prey_sp         prey_class         prey_order        prey_family 
##        "character"        "character"        "character"        "character" 
##         life_stage       vert_habitat       horz_habitat       diel_migrant 
##        "character"        "character"        "character"          "integer" 
##   diel_migrant_cat             refuge         refuge_cat     season_migrant 
##        "character"          "integer"        "character"          "integer" 
##         season_cat         body_shape              l_max       phys_defense 
##        "character"        "character"          "numeric"          "integer" 
##        transparent        col_disrupt             silver       countershade 
##          "integer"          "integer"          "integer"          "integer" 
## gregarious_primary      trophic_level   fisheries_status          b_shape_r 
##        "character"          "numeric"        "character"          "numeric" 
##         eye_body_r     standard_total     energy_density    percent_protein 
##          "numeric"          "numeric"          "numeric"          "numeric" 
##      percent_lipid              maxFO               maxN               maxM 
##          "numeric"          "numeric"          "numeric"          "numeric"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# these need to be factors to work on the trees properly}
\NormalTok{my\_prey\_prob[,}\FunctionTok{c}\NormalTok{(}\StringTok{"diel\_migrant"}\NormalTok{,}\StringTok{"refuge"}\NormalTok{,}\StringTok{"season\_migrant"}\NormalTok{, }\StringTok{"phys\_defense"}\NormalTok{, }\StringTok{"transparent"}\NormalTok{, }\StringTok{"col\_disrupt"}\NormalTok{, }\StringTok{"silver"}\NormalTok{, }\StringTok{"countershade"}\NormalTok{)] }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(my\_prey\_prob[,}\FunctionTok{c}\NormalTok{(}\StringTok{"diel\_migrant"}\NormalTok{,}\StringTok{"refuge"}\NormalTok{,}\StringTok{"season\_migrant"}\NormalTok{, }\StringTok{"phys\_defense"}\NormalTok{, }\StringTok{"transparent"}\NormalTok{, }\StringTok{"col\_disrupt"}\NormalTok{, }\StringTok{"silver"}\NormalTok{, }\StringTok{"countershade"}\NormalTok{)], factor)}

\NormalTok{my\_prey\_prob}\SpecialCharTok{$}\NormalTok{maxFO[my\_prey\_prob}\SpecialCharTok{$}\NormalTok{maxFO }\SpecialCharTok{==} \FloatTok{0.00}\NormalTok{] }\OtherTok{\textless{}{-}} \ConstantTok{NA}
\NormalTok{my\_prey\_prob}\SpecialCharTok{$}\NormalTok{maxN[my\_prey\_prob}\SpecialCharTok{$}\NormalTok{maxN }\SpecialCharTok{==} \FloatTok{0.00}\NormalTok{] }\OtherTok{\textless{}{-}} \ConstantTok{NA}
\NormalTok{my\_prey\_prob}\SpecialCharTok{$}\NormalTok{maxM[my\_prey\_prob}\SpecialCharTok{$}\NormalTok{maxM }\SpecialCharTok{==} \FloatTok{0.00}\NormalTok{] }\OtherTok{\textless{}{-}} \ConstantTok{NA}
\end{Highlighting}
\end{Shaded}

\textbf{NOTES:} A lot of troubleshooting later and I found that the
species list needs to go on the far left side of the data, all other
data/factors need to be added to the RHS of the species list

\hypertarget{tree-build}{%
\subsection{Tree Build}\label{tree-build}}

Building the basic tree

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Tree build 1}
\NormalTok{breaks }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\FunctionTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{,}\FunctionTok{nrow}\NormalTok{(my\_prey\_prob),}\DecValTok{50}\NormalTok{),}\FunctionTok{nrow}\NormalTok{(my\_prey\_prob)}\SpecialCharTok{+}\DecValTok{1}\NormalTok{)  }\CommentTok{\# why are we doing this?}
\CommentTok{\#looking up each of the species in dataset to a phylogeny, doing it by sets of 50}
\CommentTok{\#if there\textquotesingle{}s an NA (species that didn\textquotesingle{}t match a value in known phylogeny), breaks the whole chunk of 50 species}

\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\NormalTok{(}\FunctionTok{length}\NormalTok{(breaks)}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{))\{}
\NormalTok{  taxa }\OtherTok{\textless{}{-}} \FunctionTok{as.character}\NormalTok{(my\_prey\_prob}\SpecialCharTok{$}\NormalTok{prey\_sp[breaks[i]}\SpecialCharTok{:}\NormalTok{(breaks[i}\SpecialCharTok{+}\DecValTok{1}\NormalTok{]}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{)])}
\NormalTok{  taxa }\OtherTok{\textless{}{-}}\NormalTok{ taxa[taxa }\SpecialCharTok{!=} \StringTok{""} \SpecialCharTok{\&} \SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(taxa)]}

\NormalTok{  resolved\_namest }\OtherTok{\textless{}{-}} \FunctionTok{tnrs\_match\_names}\NormalTok{(taxa)                          }\CommentTok{\# I think this is where all the extra species fall out}
\NormalTok{  resolved\_namest }\OtherTok{\textless{}{-}}\NormalTok{ resolved\_namest[}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(resolved\_namest}\SpecialCharTok{$}\NormalTok{unique\_name),]  }\CommentTok{\# ignore an NA}
  \ControlFlowTok{if}\NormalTok{ (i}\SpecialCharTok{==}\DecValTok{1}\NormalTok{)\{}
\NormalTok{    resolved\_namess }\OtherTok{\textless{}{-}}\NormalTok{ resolved\_namest}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{    resolved\_namess }\OtherTok{\textless{}{-}} \FunctionTok{rbind}\NormalTok{(resolved\_namess, resolved\_namest)}
\NormalTok{  \}}
\NormalTok{\}}
\NormalTok{resolved\_names }\OtherTok{\textless{}{-}}\NormalTok{ resolved\_namess}
\NormalTok{resolved\_names }\OtherTok{\textless{}{-}}\NormalTok{ resolved\_names[resolved\_names}\SpecialCharTok{$}\NormalTok{flags}\SpecialCharTok{!=}\StringTok{"INCERTAE\_SEDIS\_INHERITED"}\NormalTok{,]}

\CommentTok{\#original tree based on simple taxon datset}
\NormalTok{my\_tree\_prob }\OtherTok{\textless{}{-}} \FunctionTok{tol\_induced\_subtree}\NormalTok{(}\AttributeTok{ott\_ids =}\NormalTok{ resolved\_names}\SpecialCharTok{$}\NormalTok{ott\_id, }\AttributeTok{label\_format =} \StringTok{"name"}\NormalTok{)}

\NormalTok{my\_tree\_prob}\SpecialCharTok{$}\NormalTok{tip.label}\OtherTok{\textless{}{-}}\FunctionTok{gsub}\NormalTok{(}\StringTok{"\_"}\NormalTok{,}\StringTok{" "}\NormalTok{,my\_tree\_prob}\SpecialCharTok{$}\NormalTok{tip.label) }\CommentTok{\# removes underscore between genus and species names}
\NormalTok{my\_tree\_prob}\SpecialCharTok{$}\NormalTok{tip.label}\OtherTok{\textless{}{-}}\FunctionTok{str\_extract}\NormalTok{(my\_tree\_prob}\SpecialCharTok{$}\NormalTok{tip.label, }\StringTok{"[A{-}Z][a{-}z]+ [a{-}z]+"}\NormalTok{)}

\NormalTok{my\_tree\_prob }\OtherTok{\textless{}{-}} \FunctionTok{compute.brlen}\NormalTok{(my\_tree\_prob, }\AttributeTok{method =} \StringTok{"Grafen"}\NormalTok{, }\AttributeTok{power =} \DecValTok{1}\SpecialCharTok{/}\DecValTok{2}\NormalTok{) }\CommentTok{\#add branch lengths to my tree using the Grafen (1989) method}
\NormalTok{my\_tree\_prob }\OtherTok{\textless{}{-}} \FunctionTok{ladderize}\NormalTok{(my\_tree\_prob, }\AttributeTok{right =} \ConstantTok{TRUE}\NormalTok{)}

\FunctionTok{View}\NormalTok{(my\_tree\_prob)}

\CommentTok{\# SAVE TREE {-}{-}{-}{-}}
\FunctionTok{write.tree}\NormalTok{(my\_tree\_prob, }\FunctionTok{here}\NormalTok{(}\StringTok{"./data/output\_data/albacore\_diet\_tree\_prob"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_tree\_prob }\OtherTok{\textless{}{-}} \FunctionTok{read.tree}\NormalTok{(}\FunctionTok{here}\NormalTok{(}\StringTok{"./data/output\_data/albacore\_diet\_tree\_prob"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\hypertarget{sort-out-the-tree-for-graphing}{%
\subsection{Sort out the tree for
graphing}\label{sort-out-the-tree-for-graphing}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#Edit tip labels}
\NormalTok{my\_tree\_prob}\SpecialCharTok{$}\NormalTok{tip.label }\OtherTok{\textless{}{-}} \FunctionTok{as.factor}\NormalTok{(}\FunctionTok{sub}\NormalTok{(}\StringTok{"\_"}\NormalTok{, }\StringTok{" "}\NormalTok{, my\_tree\_prob}\SpecialCharTok{$}\NormalTok{tip.label))}

\FunctionTok{nrow}\NormalTok{(my\_prey\_prob) }\SpecialCharTok{==} \FunctionTok{length}\NormalTok{(my\_tree\_prob}\SpecialCharTok{$}\NormalTok{tip.label) }\CommentTok{\#TRUE}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{nrow}\NormalTok{(my\_prey\_prob) }\CommentTok{\#298}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 298
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{length}\NormalTok{(my\_tree\_prob}\SpecialCharTok{$}\NormalTok{tip.label) }\CommentTok{\#298}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 298
\end{verbatim}

\textbf{NOTE:} We have in the past encountered a data frame dimension
issue when plotting our data values onto the tree. There are also
several species names that do not line up. This issue is addressed in
the chunk below.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#my\_prey\_prob$prey\_sp \textless{}{-} gsub(" ", "\_", my\_prey\_prob$prey\_sp) \#for ease of plotting take away " "}

\NormalTok{tree\_names\_prob }\OtherTok{=} \FunctionTok{data.frame}\NormalTok{(}\FunctionTok{sort}\NormalTok{(my\_tree\_prob}\SpecialCharTok{$}\NormalTok{tip.label)) }\CommentTok{\#sort the species names from the phylo tree}
\CommentTok{\#Still 301 spp}
\DocumentationTok{\#\# sort brings tree\_names\_prob from 301 to 300 because of an NA in the tip labels}
\NormalTok{prey\_names\_prob }\OtherTok{=} \FunctionTok{data.frame}\NormalTok{(}\FunctionTok{sort}\NormalTok{(my\_prey\_prob}\SpecialCharTok{$}\NormalTok{prey\_sp)) }\CommentTok{\#sort the species names from the original list}

\FunctionTok{nrow}\NormalTok{(tree\_names\_prob); }\FunctionTok{nrow}\NormalTok{(prey\_names\_prob) }\CommentTok{\#one species didn\textquotesingle{}t make it to the tree}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 298
\end{verbatim}

\begin{verbatim}
## [1] 298
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# here we check the names that are in the prey data but not on the tip labels of the tree}
\NormalTok{names\_not\_in\_tree\_prob }\OtherTok{=}\NormalTok{ prey\_names\_prob }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(sort.my\_prey\_prob.prey\_sp. }\SpecialCharTok{\%notin\%}\NormalTok{ tree\_names\_prob}\SpecialCharTok{$}\NormalTok{sort.my\_tree\_prob.tip.label.)}

\DocumentationTok{\#\# check names that are in the tree tip labels but not in the prey data}
\NormalTok{names\_not\_in\_prey\_prob }\OtherTok{=}\NormalTok{  tree\_names\_prob }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(sort.my\_tree\_prob.tip.label. }\SpecialCharTok{\%notin\%}\NormalTok{ prey\_names\_prob}\SpecialCharTok{$}\NormalTok{sort.my\_prey\_prob.prey\_sp.)}

\DocumentationTok{\#\# here we decide to match the names in the prey data to the tip labels, so we create a dataset with the names in the prey data that are in the tree (I see this looks kind of confusing with the double negative, the names not not in the tree). These are the names that do not need to be fixed, which we will bind the fixed names to afterwards so we do not get doubles of the same names (with different spelling).}
\NormalTok{my\_prey\_keep\_prob }\OtherTok{=}\NormalTok{ my\_prey\_prob }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(prey\_sp }\SpecialCharTok{\%notin\%}\NormalTok{ names\_not\_in\_tree\_prob}\SpecialCharTok{$}\NormalTok{sort.my\_prey\_prob.prey\_sp.)}

\DocumentationTok{\#\# these are the names we are going to fix to match the tip labels of the tree, given they are synonyms/misspellings. These are the same names in \textquotesingle{}names\_not\_in\_tree\_adult\textquotesingle{}, except they now have the columns of data which will allow use to merge it to \textquotesingle{}my\_prey\_keep\_adult\textquotesingle{} after we fix the names.}
\NormalTok{my\_prey\_fix\_prob }\OtherTok{=}\NormalTok{ my\_prey\_prob }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(prey\_sp }\SpecialCharTok{\%in\%}\NormalTok{ names\_not\_in\_tree\_prob}\SpecialCharTok{$}\NormalTok{sort.my\_prey\_prob.prey\_sp.)}
\DocumentationTok{\#\# this step isn\textquotesingle{}t necessary, but it does make it easier in the names are in alphabetical order}
\NormalTok{my\_prey\_fix\_prob }\OtherTok{=}\NormalTok{ my\_prey\_fix\_prob[}\FunctionTok{order}\NormalTok{(my\_prey\_fix\_prob}\SpecialCharTok{$}\NormalTok{prey\_sp),]}
\CommentTok{\# the names have to be characters for the name reassignment to work, it will give an error if we don\textquotesingle{}t do this (they are factors before this)}
\NormalTok{my\_prey\_fix\_prob}\SpecialCharTok{$}\NormalTok{prey\_sp }\OtherTok{\textless{}{-}} \FunctionTok{as.character}\NormalTok{(my\_prey\_fix\_prob}\SpecialCharTok{$}\NormalTok{prey\_sp)}
\DocumentationTok{\#\# we make these into x2 and y2 because it makes it much easier to write the next section}
\NormalTok{x2 }\OtherTok{=}\NormalTok{ my\_prey\_fix\_prob}
\NormalTok{y2 }\OtherTok{=} \FunctionTok{as.vector}\NormalTok{(names\_not\_in\_prey\_prob}\SpecialCharTok{$}\NormalTok{sort.my\_tree\_prob.tip.label.)}

\CommentTok{\#here we look at the names in both of the lists and see if there are misspellings/synonyms in the names that caused the discrepancy between the name lists. As you can see this is true for all of the species in these lists expect one. \textquotesingle{}Diplodus sargus\textquotesingle{} does not have a match in the tree, since the only other tip labels left in the tree is an NA after the rest of the reassignments.}
\CommentTok{\# if you want to see how this works you can run individual pieces of this before running the whole thing. For example x2[4,1] is "Leuroglossus stilbius", and y2[1] is "Bathylagus stilbius". Then after running this code we match the name in the prey data (x2) to the names in the tree (y2), so "Leuroglossus stilbius" becomes "Bathylagus stilbius".}
\NormalTok{x2[}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{] }\OtherTok{=}\NormalTok{ y2[}\DecValTok{4}\NormalTok{]; x2[}\DecValTok{2}\NormalTok{,}\DecValTok{1}\NormalTok{] }\OtherTok{=}\NormalTok{ y2[}\DecValTok{1}\NormalTok{]; x2[}\DecValTok{3}\NormalTok{,}\DecValTok{1}\NormalTok{] }\OtherTok{=}\NormalTok{ y2[}\DecValTok{2}\NormalTok{]; x2[}\DecValTok{4}\NormalTok{,}\DecValTok{1}\NormalTok{] }\OtherTok{=}\NormalTok{ y2[}\DecValTok{3}\NormalTok{]; }
\NormalTok{x2[}\DecValTok{5}\NormalTok{,}\DecValTok{1}\NormalTok{] }\OtherTok{=}\NormalTok{ y2[}\DecValTok{5}\NormalTok{]; x2[}\DecValTok{6}\NormalTok{,}\DecValTok{1}\NormalTok{] }\OtherTok{=}\NormalTok{ y2[}\DecValTok{7}\NormalTok{]; x2[}\DecValTok{7}\NormalTok{,}\DecValTok{1}\NormalTok{] }\OtherTok{=}\NormalTok{ y2[}\DecValTok{6}\NormalTok{];}

\CommentTok{\# we need to do the opposite for one of the names here "Diplodus sargus", which is in the prey data but not in the tip labels. So, we are replacing the NA in the tip labels}
\NormalTok{tip\_labels\_prob }\OtherTok{\textless{}{-}} \FunctionTok{as.vector}\NormalTok{(my\_tree\_prob}\SpecialCharTok{$}\NormalTok{tip.label)}
\NormalTok{tip\_labels\_prob[}\DecValTok{28}\NormalTok{] }\DocumentationTok{\#\#this is the NA we want to replace}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "NA"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tip\_labels\_prob[}\DecValTok{28}\NormalTok{] }\OtherTok{=} \StringTok{"Diplodus sargus"}
\DocumentationTok{\#\# replacing the tip labels with the additional name}
\NormalTok{my\_tree\_prob}\SpecialCharTok{$}\NormalTok{tip.label }\OtherTok{\textless{}{-}}\NormalTok{ tip\_labels\_prob}

\CommentTok{\# here we bind the fixed names to the names that didnt need to be fixed}
\NormalTok{my\_prey\_prob }\OtherTok{=} \FunctionTok{rbind}\NormalTok{(my\_prey\_keep\_prob, x2)}
\CommentTok{\#here we get rid of any of the names in the data that didn\textquotesingle{}t have a match in the tree tip labels, which was only \textquotesingle{}Diplodus sargus\textquotesingle{}}
\NormalTok{my\_prey\_prob }\OtherTok{=}\NormalTok{ my\_prey\_prob }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(prey\_sp }\SpecialCharTok{\%in\%}\NormalTok{ my\_tree\_prob}\SpecialCharTok{$}\NormalTok{tip.label)}
\FunctionTok{nrow}\NormalTok{(my\_prey\_prob);}\FunctionTok{length}\NormalTok{(my\_tree\_prob}\SpecialCharTok{$}\NormalTok{tip.label) }\DocumentationTok{\#\# one of those tip labels is an NA}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 297
\end{verbatim}

\begin{verbatim}
## [1] 298
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#the prey names need to be the rownames for the heatmap to work on the tree}
\FunctionTok{rownames}\NormalTok{(my\_prey\_prob) }\OtherTok{\textless{}{-}}\NormalTok{ my\_prey\_prob}\SpecialCharTok{$}\NormalTok{prey\_sp}

\CommentTok{\#tip labels need to be characters to pipe onto the tree}
\NormalTok{my\_tree\_prob}\SpecialCharTok{$}\NormalTok{tip.label }\OtherTok{\textless{}{-}} \FunctionTok{as.character}\NormalTok{(my\_tree\_prob}\SpecialCharTok{$}\NormalTok{tip.label)}
\FunctionTok{str}\NormalTok{(my\_tree\_prob)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## List of 5
##  $ edge       : int [1:562, 1:2] 299 300 301 302 303 304 305 306 307 308 ...
##  $ edge.length: num [1:562] 0.00168 0.24846 0.00225 0.01824 0.03549 ...
##  $ Nnode      : int 265
##  $ node.label : chr [1:265] "mrcaott42ott150" "mrcaott42ott49" "mrcaott42ott658" "Clupeocephala" ...
##  $ tip.label  : chr [1:298] "Sebastes wilsoni" "Sebastes zacentrus" "Sebastes proriger" "Sebastes brevispinis" ...
##  - attr(*, "class")= chr "phylo"
##  - attr(*, "order")= chr "cladewise"
\end{verbatim}

\hypertarget{paper-figures---the-list}{%
\subsection{Paper figures - the list}\label{paper-figures---the-list}}

\hypertarget{basic-phylogenies}{%
\subsubsection{Basic phylogenies}\label{basic-phylogenies}}

\textbf{Basic prey species phylogeny graph}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#Phylotree without labels}
\NormalTok{prob\_basic }\OtherTok{=} \FunctionTok{ggtree}\NormalTok{(my\_tree\_prob, }\AttributeTok{layout =} \StringTok{\textquotesingle{}circular\textquotesingle{}}\NormalTok{)}

\CommentTok{\#Phylotree with species labels}
\NormalTok{prob\_basic\_lab }\OtherTok{=} \FunctionTok{ggtree}\NormalTok{(my\_tree\_prob, }\AttributeTok{layout =} \StringTok{\textquotesingle{}circular\textquotesingle{}}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{geom\_tiplab}\NormalTok{(}\AttributeTok{size =} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\textbf{Class-based phylogeny graph}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#Use basic + prey\_sp labels + prey\_class}

\CommentTok{\# creating a dataset that splits the species data by class}
\NormalTok{prey\_class\_prob\_info }\OtherTok{\textless{}{-}} \FunctionTok{split}\NormalTok{(}\AttributeTok{x =}\NormalTok{ my\_prey\_prob}\SpecialCharTok{$}\NormalTok{prey\_sp, }\AttributeTok{f =}\NormalTok{ my\_prey\_prob}\SpecialCharTok{$}\NormalTok{prey\_class)}
\FunctionTok{unique}\NormalTok{(my\_prey\_prob}\SpecialCharTok{$}\NormalTok{prey\_class)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Cephalopoda"    "Malacostraca"   "Actinopterygii" "Gastropoda"    
## [5] "Hexanauplia"    "Hydrozoa"       NA               "Thaliacea"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# splitting the tree species by class}
\NormalTok{my\_tree\_prob\_class }\OtherTok{\textless{}{-}} \FunctionTok{groupOTU}\NormalTok{(my\_tree\_prob, prey\_class\_prob\_info)}
\FunctionTok{as.character}\NormalTok{(}\FunctionTok{sort}\NormalTok{(}\FunctionTok{unique}\NormalTok{(my\_prey\_prob}\SpecialCharTok{$}\NormalTok{prey\_class)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Actinopterygii" "Cephalopoda"    "Gastropoda"     "Hexanauplia"   
## [5] "Hydrozoa"       "Malacostraca"   "Thaliacea"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#creating a palette for the class split}
\CommentTok{\#pal\_prob\_class = c("grey40", \textquotesingle{}\#0047ab\textquotesingle{}, \textquotesingle{}\#751308\textquotesingle{}, \textquotesingle{}\#4B0082\textquotesingle{}, \textquotesingle{}\#F05E23\textquotesingle{}, \textquotesingle{}\#013220\textquotesingle{}, \textquotesingle{}\#B80F0A\textquotesingle{}, "\#66C2A5", "\#3288BD") \#\# the grey40 is needed for a branch between branches, but doesn\textquotesingle{}t assign to a class}


\NormalTok{pal\_prob\_class }\OtherTok{=} \FunctionTok{c}\NormalTok{(}\StringTok{"grey40"}\NormalTok{, }\DocumentationTok{\#\# the grey40 is needed for a branch between branches, but doesn\textquotesingle{}t assign to a class}
                    \StringTok{\textquotesingle{}\#0047ab\textquotesingle{}}\NormalTok{, }\CommentTok{\#Actinopterygii}
                    \CommentTok{\#\textquotesingle{}\#751308\textquotesingle{}, \#Branchiopoda \#older teal colour "\#66C2A5" \#Not in prob data just was used for adult data}
                    \StringTok{\textquotesingle{}\#4B0082\textquotesingle{}}\NormalTok{, }\CommentTok{\#Cephalopoda}
                    \StringTok{"\#AD15E2"}\NormalTok{, }\CommentTok{\#Gastropoda \#old orange \textquotesingle{}\#F05E23\textquotesingle{}}
                    \StringTok{\textquotesingle{}\#B80F0A\textquotesingle{}}\NormalTok{, }\CommentTok{\#Hexanauplia}
                    \StringTok{"\#773405"}\NormalTok{, }\CommentTok{\#Hydrozoa \#\textquotesingle{}\#013220\textquotesingle{}}
                    \StringTok{"\#E86103"}\NormalTok{, }\CommentTok{\#Malacostraca \textquotesingle{}}
                    \StringTok{"\#3288BD"}  \CommentTok{\#Thaliacea}
\NormalTok{                    )}

\DocumentationTok{\#\# plotting the tree without tip labels}

\NormalTok{prob\_class }\OtherTok{\textless{}{-}} \FunctionTok{ggtree}\NormalTok{(my\_tree\_prob\_class, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{color =}\NormalTok{ group), }\AttributeTok{layout =} \StringTok{\textquotesingle{}circular\textquotesingle{}}\NormalTok{) }\SpecialCharTok{+}
   \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.5}\NormalTok{,}\FloatTok{0.50}\NormalTok{),}
        \AttributeTok{legend.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{18}\NormalTok{), }
        \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{18}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{scale\_colour\_manual}\NormalTok{(}\StringTok{\textquotesingle{}Class\textquotesingle{}}\NormalTok{, }\AttributeTok{aesthetics =} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}colour\textquotesingle{}}\NormalTok{), }\AttributeTok{values =}\NormalTok{ pal\_prob\_class,}
                      \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}\StringTok{"Actinopterygii"}\NormalTok{, }\StringTok{"Cephalopoda"}\NormalTok{,}\StringTok{"Gastropoda"}\NormalTok{, }\StringTok{"Hexanauplia"}\NormalTok{, }\StringTok{"Hydrozoa"}\NormalTok{, }\StringTok{"Malacostraca"}\NormalTok{,}\StringTok{"Thaliacea"}\NormalTok{),}
                      \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Actinopterygii"}\NormalTok{, }\StringTok{"Cephalopoda"}\NormalTok{,}\StringTok{"Gastropoda"}\NormalTok{, }\StringTok{"Hexanauplia"}\NormalTok{, }\StringTok{"Hydrozoa"}\NormalTok{, }\StringTok{"Malacostraca"}\NormalTok{,}\StringTok{"Thaliacea"}\NormalTok{))}

\NormalTok{prob\_class}
\end{Highlighting}
\end{Shaded}

\includegraphics{Albacore_synthesis_a_phylo_files/figure-latex/Figure B Prey Class basic-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# plotting the tree with tip labels}
\NormalTok{prob\_class\_lab }\OtherTok{\textless{}{-}} \FunctionTok{ggtree}\NormalTok{(my\_tree\_prob\_class, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{color =}\NormalTok{ group), }\AttributeTok{layout =} \StringTok{\textquotesingle{}circular\textquotesingle{}}\NormalTok{) }\SpecialCharTok{+}
   \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.5}\NormalTok{,}\FloatTok{0.50}\NormalTok{),}
        \AttributeTok{legend.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{18}\NormalTok{), }
        \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{18}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{scale\_colour\_manual}\NormalTok{(}\StringTok{\textquotesingle{}Class\textquotesingle{}}\NormalTok{, }\AttributeTok{aesthetics =} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}colour\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}fill\textquotesingle{}}\NormalTok{), }\AttributeTok{values =}\NormalTok{ pal\_prob\_class,}
                      \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}\StringTok{"Actinopterygii"}\NormalTok{, }\StringTok{"Cephalopoda"}\NormalTok{,}\StringTok{"Gastropoda"}\NormalTok{, }\StringTok{"Hexanauplia"}\NormalTok{, }\StringTok{"Hydrozoa"}\NormalTok{, }\StringTok{"Malacostraca"}\NormalTok{,}\StringTok{"Thaliacea"}\NormalTok{),}
                      \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Actinopterygii"}\NormalTok{, }\StringTok{"Cephalopoda"}\NormalTok{,}\StringTok{"Gastropoda"}\NormalTok{, }\StringTok{"Hexanauplia"}\NormalTok{, }\StringTok{"Hydrozoa"}\NormalTok{, }\StringTok{"Malacostraca"}\NormalTok{,}\StringTok{"Thaliacea"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{geom\_tiplab}\NormalTok{(}\AttributeTok{size =} \DecValTok{2}\NormalTok{)}

\NormalTok{prob\_class\_lab}
\end{Highlighting}
\end{Shaded}

\includegraphics{Albacore_synthesis_a_phylo_files/figure-latex/Figure B Prey Class basic-2.pdf}

\hypertarget{diet-use-data}{%
\subsubsection{Diet use data}\label{diet-use-data}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#Overlay maxFO (frequency of occurrence data) on a basic prey tree coloured by Class}
\CommentTok{\#Use prey\_class, maxFO}

\NormalTok{prob\_maxfo }\OtherTok{\textless{}{-}} \FunctionTok{gheatmap}\NormalTok{(prob\_class, my\_prey\_prob[,}\StringTok{"maxFO"}\NormalTok{, }\AttributeTok{drop =} \ConstantTok{FALSE}\NormalTok{], }
                       \AttributeTok{offset =} \DecValTok{0}\NormalTok{, }\AttributeTok{width =} \FloatTok{0.05}\NormalTok{, }\AttributeTok{colnames =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\CommentTok{\#legend.position = c(0.5,0.50),}
        \AttributeTok{legend.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{18}\NormalTok{), }
        \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{18}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_viridis\_c}\NormalTok{(}\AttributeTok{name =} \StringTok{"Percent frequency (\%FO)"}\NormalTok{, }\AttributeTok{na.value =} \StringTok{\textquotesingle{}grey\textquotesingle{}}\NormalTok{)}

\NormalTok{prob\_maxfo}
\end{Highlighting}
\end{Shaded}

\includegraphics{Albacore_synthesis_a_phylo_files/figure-latex/Figure E Frequency Occurrence-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#Overlay maxN (abundance data) on a basic prey tree coloured by Class}
\CommentTok{\#Use prey\_class, maxN}

\NormalTok{prob\_maxn }\OtherTok{\textless{}{-}} \FunctionTok{gheatmap}\NormalTok{(prob\_class, my\_prey\_prob[,}\StringTok{"maxN"}\NormalTok{, }\AttributeTok{drop =} \ConstantTok{FALSE}\NormalTok{], }
                      \AttributeTok{offset =} \DecValTok{0}\NormalTok{, }\AttributeTok{width =} \FloatTok{0.05}\NormalTok{, }\AttributeTok{colnames =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\CommentTok{\#legend.position = c(0.5,0.50),}
        \AttributeTok{legend.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{18}\NormalTok{), }
        \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{18}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_viridis\_c}\NormalTok{(}\AttributeTok{name =} \StringTok{"Percent abundance (\%N)"}\NormalTok{, }\AttributeTok{na.value =} \StringTok{\textquotesingle{}grey\textquotesingle{}}\NormalTok{)}
\NormalTok{prob\_maxn}
\end{Highlighting}
\end{Shaded}

\includegraphics{Albacore_synthesis_a_phylo_files/figure-latex/Figure F Abundance-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#Overlay maxM (biomass data) on a basic prey tree coloured by Class}
\CommentTok{\#Use prey\_class, maxM}

\NormalTok{prob\_maxm }\OtherTok{\textless{}{-}} \FunctionTok{gheatmap}\NormalTok{(prob\_class, my\_prey\_prob[,}\StringTok{"maxM"}\NormalTok{, }\AttributeTok{drop =} \ConstantTok{FALSE}\NormalTok{], }
                      \AttributeTok{offset =} \DecValTok{0}\NormalTok{, }\AttributeTok{width =} \FloatTok{0.05}\NormalTok{, }\AttributeTok{colnames =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\CommentTok{\#legend.position = c(0.5,0.50),}
        \AttributeTok{legend.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{18}\NormalTok{), }
        \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{18}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_viridis\_c}\NormalTok{(}\AttributeTok{name =} \StringTok{"Percent biomass (\%KG)"}\NormalTok{, }\AttributeTok{na.value =} \StringTok{\textquotesingle{}grey\textquotesingle{}}\NormalTok{)}
\NormalTok{prob\_maxm}
\end{Highlighting}
\end{Shaded}

\includegraphics{Albacore_synthesis_a_phylo_files/figure-latex/Figure G Mass-1.pdf}

\hypertarget{trait-data}{%
\subsubsection{Trait data}\label{trait-data}}

For habitat use traits: we are going to plot multiple rings of data
around the phylogenetic trees using vert\_habitat, horz\_habitat,
diel\_migrant (change to yes/no), and season\_migrant (yes/no)

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#creating this plot one iteration at a time. Adding one layer of the heatmap, then allowing for another legend on the plot, and then another layer of the heatmap}

\NormalTok{habitat\_traits\_prob1 }\OtherTok{\textless{}{-}} \FunctionTok{gheatmap}\NormalTok{(prob\_basic, my\_prey\_prob[, }\StringTok{\textquotesingle{}vert\_habitat\textquotesingle{}}\NormalTok{,}\AttributeTok{drop=}\ConstantTok{FALSE}\NormalTok{], }
                                 \AttributeTok{offset=} \DecValTok{0}\NormalTok{, }\AttributeTok{width=}\FloatTok{0.05}\NormalTok{, }\AttributeTok{colnames =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_viridis\_d}\NormalTok{(}\AttributeTok{name =} \StringTok{"Vertical Habitat (VH)"}\NormalTok{, }
                       \AttributeTok{direction =} \SpecialCharTok{{-}}\DecValTok{1}\NormalTok{, }
                       \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}\StringTok{"benthic"}\NormalTok{, }\StringTok{"demersal"}\NormalTok{, }\StringTok{"epipelagic"}\NormalTok{, }\StringTok{"mesopelagic"}\NormalTok{, }\StringTok{"bathypelagic"}\NormalTok{),}
                       \AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\StringTok{"benthic"}\NormalTok{, }\StringTok{"demersal"}\NormalTok{, }\StringTok{"epipelagic"}\NormalTok{, }\StringTok{"mesopelagic"}\NormalTok{, }\StringTok{"bathypelagic"}\NormalTok{), }
                       \AttributeTok{na.translate =} \ConstantTok{TRUE}\NormalTok{, }
                       \AttributeTok{option =} \StringTok{\textquotesingle{}D\textquotesingle{}}\NormalTok{, }
                       \AttributeTok{na.value =} \StringTok{\textquotesingle{}grey\textquotesingle{}}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\FloatTok{0.80}\NormalTok{),}
        \AttributeTok{legend.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{18}\NormalTok{), }
        \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{18}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{scale\_y\_continuous}\NormalTok{(}\AttributeTok{expand =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{4}\NormalTok{))}\SpecialCharTok{+} \CommentTok{\#this opens up the gap for the Vertical habitat label around the tree}
  \FunctionTok{annotate}\NormalTok{(}\StringTok{\textquotesingle{}text\textquotesingle{}}\NormalTok{, }\AttributeTok{x =} \FloatTok{1.03}\NormalTok{, }\AttributeTok{y =} \SpecialCharTok{{-}}\DecValTok{7}\NormalTok{, }\AttributeTok{label =} \StringTok{\textquotesingle{}VH\textquotesingle{}}\NormalTok{, }\AttributeTok{angle =} \SpecialCharTok{{-}}\DecValTok{85}\NormalTok{, }\AttributeTok{size =} \DecValTok{4}\NormalTok{)}

\NormalTok{habitat\_traits\_prob1}\FloatTok{.5} \OtherTok{\textless{}{-}}\NormalTok{ habitat\_traits\_prob1 }\SpecialCharTok{+} \FunctionTok{new\_scale\_fill}\NormalTok{()}

\NormalTok{habitat\_traits\_prob2 }\OtherTok{\textless{}{-}} \FunctionTok{gheatmap}\NormalTok{(habitat\_traits\_prob1}\FloatTok{.5}\NormalTok{, my\_prey\_prob[ ,}\StringTok{\textquotesingle{}horz\_habitat\textquotesingle{}}\NormalTok{,}\AttributeTok{drop=}\ConstantTok{FALSE}\NormalTok{], }
                                 \AttributeTok{offset=}\FloatTok{0.05}\NormalTok{, }\AttributeTok{width=}\FloatTok{0.05}\NormalTok{, }\AttributeTok{colnames =}\NormalTok{ F) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_viridis\_d}\NormalTok{(}\AttributeTok{name =} \StringTok{"Horizontal Habitat (HH)"}\NormalTok{, }
                       \AttributeTok{option =} \StringTok{"D"}\NormalTok{, }
                       \AttributeTok{direction =} \SpecialCharTok{{-}}\DecValTok{1}\NormalTok{,}
                       \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}\StringTok{"reef{-}associated"}\NormalTok{, }\StringTok{"coastal"}\NormalTok{, }\StringTok{"continental shelf"}\NormalTok{,}\StringTok{"continental slope"}\NormalTok{, }\StringTok{"oceanic"}\NormalTok{),}
                       \AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\StringTok{"reef{-}associated"}\NormalTok{, }\StringTok{"coastal"}\NormalTok{, }\StringTok{"continental shelf"}\NormalTok{,}\StringTok{"continental slope"}\NormalTok{, }\StringTok{"oceanic"}\NormalTok{),}
                       \AttributeTok{na.translate =} \ConstantTok{TRUE}\NormalTok{, }
                       \AttributeTok{na.value =} \StringTok{\textquotesingle{}grey\textquotesingle{}}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\FloatTok{0.683}\NormalTok{),}
        \AttributeTok{legend.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{18}\NormalTok{), }
        \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{18}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{scale\_y\_continuous}\NormalTok{(}\AttributeTok{expand =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{4}\NormalTok{))}\SpecialCharTok{+}
\FunctionTok{annotate}\NormalTok{(}\StringTok{\textquotesingle{}text\textquotesingle{}}\NormalTok{, }\AttributeTok{x =} \FloatTok{1.08}\NormalTok{, }\AttributeTok{y =} \SpecialCharTok{{-}}\FloatTok{7.1}\NormalTok{, }\AttributeTok{label =} \StringTok{\textquotesingle{}HH\textquotesingle{}}\NormalTok{, }\AttributeTok{angle =} \SpecialCharTok{{-}}\DecValTok{85}\NormalTok{, }\AttributeTok{size =} \DecValTok{4}\NormalTok{)}

\NormalTok{habitat\_traits\_prob2}\FloatTok{.5} \OtherTok{\textless{}{-}}\NormalTok{ habitat\_traits\_prob2 }\SpecialCharTok{+} \FunctionTok{new\_scale\_fill}\NormalTok{()}

\NormalTok{habitat\_traits\_prob3 }\OtherTok{\textless{}{-}} \FunctionTok{gheatmap}\NormalTok{(habitat\_traits\_prob2}\FloatTok{.5}\NormalTok{, my\_prey\_prob[ , }\StringTok{\textquotesingle{}diel\_migrant\textquotesingle{}}\NormalTok{,}\AttributeTok{drop=}\ConstantTok{FALSE}\NormalTok{], }\AttributeTok{offset=}\FloatTok{0.10}\NormalTok{, }\AttributeTok{width=}\FloatTok{0.05}\NormalTok{, }\AttributeTok{colnames =}\NormalTok{ F) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{name =} \StringTok{"Diel Migrant (DM)"}\NormalTok{,}
                    \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}\StringTok{"0"}\NormalTok{, }\StringTok{"1"}\NormalTok{),}
                    \AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\StringTok{"0"}\NormalTok{, }\StringTok{"1"}\NormalTok{),}
                    \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"no"}\NormalTok{,}\StringTok{"yes"}\NormalTok{),}
                    \AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"0"}\OtherTok{=}\StringTok{"\#FDE725FF"}\NormalTok{, }\StringTok{"1"}\OtherTok{=}\StringTok{"\#39568CFF"}\NormalTok{), }
                    \AttributeTok{na.value =} \StringTok{\textquotesingle{}grey\textquotesingle{}}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\FloatTok{0.5985}\NormalTok{),}
        \AttributeTok{legend.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{18}\NormalTok{), }
        \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{18}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{scale\_y\_continuous}\NormalTok{(}\AttributeTok{expand =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{4}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{annotate}\NormalTok{(}\StringTok{\textquotesingle{}text\textquotesingle{}}\NormalTok{, }\AttributeTok{x =} \FloatTok{1.13}\NormalTok{, }\AttributeTok{y =} \SpecialCharTok{{-}}\FloatTok{7.5}\NormalTok{, }\AttributeTok{label =} \StringTok{\textquotesingle{}DM\textquotesingle{}}\NormalTok{, }\AttributeTok{angle =} \SpecialCharTok{{-}}\DecValTok{85}\NormalTok{, }\AttributeTok{size =} \DecValTok{4}\NormalTok{)}

\NormalTok{habitat\_traits\_prob3}\FloatTok{.5} \OtherTok{\textless{}{-}}\NormalTok{ habitat\_traits\_prob3 }\SpecialCharTok{+} \FunctionTok{new\_scale\_fill}\NormalTok{()}

\NormalTok{habitat\_traits\_prob\_final }\OtherTok{\textless{}{-}} \FunctionTok{gheatmap}\NormalTok{(habitat\_traits\_prob3}\FloatTok{.5}\NormalTok{, }
\NormalTok{                                      my\_prey\_prob[ ,}\StringTok{\textquotesingle{}season\_migrant\textquotesingle{}}\NormalTok{,}\AttributeTok{drop=}\ConstantTok{FALSE}\NormalTok{],}
                                     \AttributeTok{offset=}\FloatTok{0.15}\NormalTok{, }\AttributeTok{width=}\FloatTok{0.05}\NormalTok{, }\AttributeTok{colnames =}\NormalTok{ F) }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \FunctionTok{c}\NormalTok{(}\FloatTok{1.05}\NormalTok{,}\FloatTok{0.50}\NormalTok{),}
        \AttributeTok{legend.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{18}\NormalTok{), }
        \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{18}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{name =} \StringTok{"Seasonal Migrant (SM)"}\NormalTok{,}
                    \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}\StringTok{"0"}\NormalTok{, }\StringTok{"1"}\NormalTok{),}
                    \AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\StringTok{"0"}\NormalTok{, }\StringTok{"1"}\NormalTok{),}
                    \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"no"}\NormalTok{, }\StringTok{"yes"}\NormalTok{),}
                    \AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"0"}\OtherTok{=}\StringTok{"\#FDE725FF"}\NormalTok{, }\StringTok{"1"}\OtherTok{=}\StringTok{"\#39568CFF"}\NormalTok{), }
                    \AttributeTok{na.value =} \StringTok{\textquotesingle{}grey\textquotesingle{}}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_y\_continuous}\NormalTok{(}\AttributeTok{expand =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{4}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{annotate}\NormalTok{(}\StringTok{\textquotesingle{}text\textquotesingle{}}\NormalTok{, }\AttributeTok{x =} \FloatTok{1.18}\NormalTok{, }\AttributeTok{y =} \SpecialCharTok{{-}}\FloatTok{7.5}\NormalTok{, }\AttributeTok{label =} \StringTok{\textquotesingle{}SM\textquotesingle{}}\NormalTok{, }\AttributeTok{angle =} \SpecialCharTok{{-}}\DecValTok{85}\NormalTok{, }\AttributeTok{size =} \DecValTok{4}\NormalTok{)}

  
\CommentTok{\#Check graph}
\NormalTok{habitat\_traits\_prob\_final}
\end{Highlighting}
\end{Shaded}

\includegraphics{Albacore_synthesis_a_phylo_files/figure-latex/Figure H Habitat use traits-1.pdf}

For seasonal, trophic \& aggregation behaviour use: trophic\_level,
gregarious\_primary and refuge\_use (yes/no)

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{behav\_trophic\_prob1 }\OtherTok{\textless{}{-}} \FunctionTok{gheatmap}\NormalTok{(prob\_basic, my\_prey\_prob[,}\StringTok{\textquotesingle{}trophic\_level\textquotesingle{}}\NormalTok{, }\AttributeTok{drop=}\ConstantTok{FALSE}\NormalTok{], }
                                \AttributeTok{offset=}\DecValTok{0}\NormalTok{, }\AttributeTok{width=}\FloatTok{0.05}\NormalTok{, }\AttributeTok{colnames =}\NormalTok{ F) }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \FunctionTok{c}\NormalTok{(}\FloatTok{1.05}\NormalTok{,}\FloatTok{0.80}\NormalTok{),}
        \AttributeTok{legend.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{18}\NormalTok{), }
        \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{18}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_viridis\_c}\NormalTok{(}\AttributeTok{name =} \StringTok{"Trophic Level (TL)"}\NormalTok{, }\AttributeTok{na.value =} \StringTok{\textquotesingle{}grey\textquotesingle{}}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_y\_continuous}\NormalTok{(}\AttributeTok{expand =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\FloatTok{3.5}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{annotate}\NormalTok{(}\StringTok{\textquotesingle{}text\textquotesingle{}}\NormalTok{, }\AttributeTok{x =} \FloatTok{1.04}\NormalTok{, }\AttributeTok{y =} \SpecialCharTok{{-}}\FloatTok{6.5}\NormalTok{, }\AttributeTok{label =} \StringTok{\textquotesingle{}TL\textquotesingle{}}\NormalTok{, }\AttributeTok{angle =} \SpecialCharTok{{-}}\DecValTok{85}\NormalTok{, }\AttributeTok{size =} \DecValTok{4}\NormalTok{)}

\NormalTok{behav\_trophic\_prob1}\FloatTok{.5} \OtherTok{\textless{}{-}}\NormalTok{ behav\_trophic\_prob1 }\SpecialCharTok{+} \FunctionTok{new\_scale\_fill}\NormalTok{()}

\NormalTok{behav\_trophic\_prob2 }\OtherTok{\textless{}{-}} \FunctionTok{gheatmap}\NormalTok{(behav\_trophic\_prob1}\FloatTok{.5}\NormalTok{, my\_prey\_prob[,}\StringTok{"gregarious\_primary"}\NormalTok{,}\AttributeTok{drop=}\ConstantTok{FALSE}\NormalTok{], }
                                \AttributeTok{offset=}\FloatTok{0.05}\NormalTok{, }\AttributeTok{width=}\FloatTok{0.05}\NormalTok{, }\AttributeTok{colnames =}\NormalTok{ F) }\SpecialCharTok{+}
   \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \FunctionTok{c}\NormalTok{(}\FloatTok{1.05}\NormalTok{,}\FloatTok{0.65}\NormalTok{),}
        \AttributeTok{legend.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{18}\NormalTok{), }
        \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{18}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_viridis\_d}\NormalTok{(}\AttributeTok{name =} \StringTok{"Gregariousness (GG)"}\NormalTok{, }
                       \AttributeTok{direction =} \SpecialCharTok{{-}}\DecValTok{1}\NormalTok{,}
                       \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}\StringTok{"solitary"}\NormalTok{, }\StringTok{"shoaling"}\NormalTok{,}\StringTok{"schooling"}\NormalTok{),}
                       \AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\StringTok{"solitary"}\NormalTok{, }\StringTok{"shoaling"}\NormalTok{,}\StringTok{"schooling"}\NormalTok{),}
                       \AttributeTok{na.translate =} \ConstantTok{TRUE}\NormalTok{,}
                       \AttributeTok{option =} \StringTok{"D"}\NormalTok{, }\CommentTok{\#\textquotesingle{}magma\textquotesingle{},}
                       \AttributeTok{begin =} \FloatTok{0.2}\NormalTok{,}\AttributeTok{end =} \FloatTok{0.8}\NormalTok{,}
                       \AttributeTok{guide =} \FunctionTok{guide\_legend}\NormalTok{(}\AttributeTok{order =} \DecValTok{1}\NormalTok{), }
                       \AttributeTok{na.value =} \StringTok{\textquotesingle{}grey\textquotesingle{}}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{scale\_y\_continuous}\NormalTok{(}\AttributeTok{expand =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\FloatTok{3.5}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{annotate}\NormalTok{(}\StringTok{\textquotesingle{}text\textquotesingle{}}\NormalTok{, }\AttributeTok{x =} \FloatTok{1.09}\NormalTok{, }\AttributeTok{y =} \SpecialCharTok{{-}}\FloatTok{6.5}\NormalTok{, }\AttributeTok{label =} \StringTok{\textquotesingle{}GG\textquotesingle{}}\NormalTok{, }\AttributeTok{angle =} \SpecialCharTok{{-}}\DecValTok{85}\NormalTok{, }\AttributeTok{size =} \DecValTok{4}\NormalTok{)}

\NormalTok{behav\_trophic\_prob2}\FloatTok{.5} \OtherTok{\textless{}{-}}\NormalTok{ behav\_trophic\_prob2 }\SpecialCharTok{+} \FunctionTok{new\_scale\_fill}\NormalTok{()}

\NormalTok{behav\_trophic\_prob\_final }\OtherTok{\textless{}{-}} \FunctionTok{gheatmap}\NormalTok{(behav\_trophic\_prob2}\FloatTok{.5}\NormalTok{, }
\NormalTok{                                     my\_prey\_prob[ ,}\StringTok{\textquotesingle{}refuge\textquotesingle{}}\NormalTok{,}\AttributeTok{drop=}\ConstantTok{FALSE}\NormalTok{], }
                                     \AttributeTok{offset=}\FloatTok{0.10}\NormalTok{, }\AttributeTok{width=}\FloatTok{0.05}\NormalTok{, }\AttributeTok{colnames =}\NormalTok{ F)}\SpecialCharTok{+}  
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{name =} \StringTok{"Refuge (RF)"}\NormalTok{,}
                    \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}\StringTok{"0"}\NormalTok{, }\StringTok{"1"}\NormalTok{),}
                    \AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\StringTok{"0"}\NormalTok{, }\StringTok{"1"}\NormalTok{),}
                    \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"no"}\NormalTok{, }\StringTok{"yes"}\NormalTok{),}
                    \AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"1"}\OtherTok{=}\StringTok{"\#FDE725FF"}\NormalTok{, }\StringTok{"0"}\OtherTok{=}\StringTok{"\#39568CFF"}\NormalTok{),}
                    \AttributeTok{na.value =} \StringTok{\textquotesingle{}grey\textquotesingle{}}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\FloatTok{0.531}\NormalTok{),}
        \AttributeTok{legend.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{18}\NormalTok{), }
        \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{18}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{scale\_y\_continuous}\NormalTok{(}\AttributeTok{expand =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{4}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{annotate}\NormalTok{(}\StringTok{\textquotesingle{}text\textquotesingle{}}\NormalTok{, }\AttributeTok{x =} \FloatTok{1.14}\NormalTok{, }\AttributeTok{y =} \SpecialCharTok{{-}}\FloatTok{6.5}\NormalTok{, }\AttributeTok{label =} \StringTok{\textquotesingle{}RF\textquotesingle{}}\NormalTok{, }\AttributeTok{angle =} \SpecialCharTok{{-}}\DecValTok{85}\NormalTok{, }\AttributeTok{size =} \DecValTok{4}\NormalTok{)}

\NormalTok{behav\_trophic\_prob\_final}
\end{Highlighting}
\end{Shaded}

\includegraphics{Albacore_synthesis_a_phylo_files/figure-latex/Figure I Behaviour-1.pdf}

For morphological (shape) traits use: body\_shape, b\_shape\_r and
eye\_body\_r

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{levels}\NormalTok{(}\FunctionTok{as.factor}\NormalTok{(my\_prey\_prob}\SpecialCharTok{$}\NormalTok{body\_shape))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "compressiform" "depressiform"  "eel-like"      "elongated"    
## [5] "fusiform"      "globiform"     "unique"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_prey\_prob}\SpecialCharTok{$}\NormalTok{body\_shape }\OtherTok{\textless{}{-}} \FunctionTok{as.factor}\NormalTok{(my\_prey\_prob}\SpecialCharTok{$}\NormalTok{body\_shape)}
\NormalTok{my\_prey\_prob}\SpecialCharTok{$}\NormalTok{body\_shape }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(my\_prey\_prob}\SpecialCharTok{$}\NormalTok{body\_shape,}
                                  \AttributeTok{levels =} \FunctionTok{c}\NormalTok{(}\StringTok{"unique"}\NormalTok{, }\StringTok{"globiform"}\NormalTok{, }\StringTok{"depressiform"}\NormalTok{, }\StringTok{"compressiform"}\NormalTok{,}
                                             \StringTok{"fusiform"}\NormalTok{, }\StringTok{"elongated"}\NormalTok{, }\StringTok{"eel{-}like"}\NormalTok{))}
\FunctionTok{levels}\NormalTok{(my\_prey\_prob}\SpecialCharTok{$}\NormalTok{body\_shape)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "unique"        "globiform"     "depressiform"  "compressiform"
## [5] "fusiform"      "elongated"     "eel-like"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{morphology\_comparison\_prob1 }\OtherTok{\textless{}{-}} \FunctionTok{gheatmap}\NormalTok{(prob\_basic, }
\NormalTok{                                        my\_prey\_prob[ ,}\StringTok{\textquotesingle{}body\_shape\textquotesingle{}}\NormalTok{,}\AttributeTok{drop=}\ConstantTok{FALSE}\NormalTok{],}
                                        \AttributeTok{offset=}\DecValTok{0}\NormalTok{, }\AttributeTok{width=}\FloatTok{0.05}\NormalTok{,}\AttributeTok{font.size=}\DecValTok{2}\NormalTok{, }\AttributeTok{colnames =}\NormalTok{ F) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_viridis\_d}\NormalTok{(}\AttributeTok{name =} \StringTok{"Body Shape (BD)"}\NormalTok{, }
                       \AttributeTok{option =} \StringTok{\textquotesingle{}C\textquotesingle{}}\NormalTok{,}
                       \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}\StringTok{"unique"}\NormalTok{, }\StringTok{"globiform"}\NormalTok{, }\StringTok{"depressiform"}\NormalTok{, }\StringTok{"compressiform"}\NormalTok{,}
                                  \StringTok{"fusiform"}\NormalTok{, }\StringTok{"elongated"}\NormalTok{, }\StringTok{"eel{-}like"}\NormalTok{),}
                       \AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\StringTok{"unique"}\NormalTok{, }\StringTok{"globiform"}\NormalTok{, }\StringTok{"depressiform"}\NormalTok{, }\StringTok{"compressiform"}\NormalTok{,}
                                  \StringTok{"fusiform"}\NormalTok{, }\StringTok{"elongated"}\NormalTok{, }\StringTok{"eel{-}like"}\NormalTok{),}
                       \AttributeTok{guide =} \FunctionTok{guide\_legend}\NormalTok{(}\AttributeTok{order =} \DecValTok{1}\NormalTok{, }
                                            \CommentTok{\#reverse = TRUE}
\NormalTok{                                            ), }\CommentTok{\#order = 1}
                       \AttributeTok{na.value =} \StringTok{\textquotesingle{}grey\textquotesingle{}}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \FunctionTok{c}\NormalTok{(}\FloatTok{1.05}\NormalTok{,}\FloatTok{0.71}\NormalTok{),}
        \AttributeTok{legend.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{18}\NormalTok{), }
        \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{18}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{scale\_y\_continuous}\NormalTok{(}\AttributeTok{expand =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\FloatTok{3.5}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{annotate}\NormalTok{(}\StringTok{\textquotesingle{}text\textquotesingle{}}\NormalTok{, }\AttributeTok{x =} \FloatTok{1.04}\NormalTok{, }\AttributeTok{y =} \SpecialCharTok{{-}}\FloatTok{6.5}\NormalTok{, }\AttributeTok{label =} \StringTok{\textquotesingle{}BD\textquotesingle{}}\NormalTok{, }\AttributeTok{angle =} \SpecialCharTok{{-}}\DecValTok{85}\NormalTok{, }\AttributeTok{size =} \DecValTok{4}\NormalTok{)}

\NormalTok{morphology\_comparison\_prob1}\FloatTok{.5} \OtherTok{\textless{}{-}}\NormalTok{ morphology\_comparison\_prob1 }\SpecialCharTok{+} \FunctionTok{new\_scale\_fill}\NormalTok{()}

\NormalTok{morphology\_comparison\_prob2 }\OtherTok{\textless{}{-}} \FunctionTok{gheatmap}\NormalTok{(morphology\_comparison\_prob1}\FloatTok{.5}\NormalTok{, }
\NormalTok{                                        my\_prey\_prob[ ,}\StringTok{\textquotesingle{}b\_shape\_r\textquotesingle{}}\NormalTok{,}\AttributeTok{drop=}\ConstantTok{FALSE}\NormalTok{], }
                                        \AttributeTok{offset=}\FloatTok{0.05}\NormalTok{, }\AttributeTok{width=}\FloatTok{0.05}\NormalTok{, }\AttributeTok{colnames =}\NormalTok{ F) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_viridis\_c}\NormalTok{(}\AttributeTok{name =} \StringTok{"Body Shape Ratio (BDR)"}\NormalTok{, }
                       \AttributeTok{option =} \StringTok{\textquotesingle{}C\textquotesingle{}}\NormalTok{, }\AttributeTok{limits=}\FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{15}\NormalTok{), }
                       \AttributeTok{oob =}\NormalTok{ scales}\SpecialCharTok{::}\NormalTok{squish, }
                       \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{5}\NormalTok{,}\DecValTok{10}\NormalTok{,}\DecValTok{15}\NormalTok{), }
                       \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{5}\NormalTok{,}\DecValTok{10}\NormalTok{,}\StringTok{"15+"}\NormalTok{), }
                       \AttributeTok{na.value =} \StringTok{\textquotesingle{}grey\textquotesingle{}}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \FunctionTok{c}\NormalTok{(}\FloatTok{1.05}\NormalTok{,}\FloatTok{0.605}\NormalTok{),}
        \AttributeTok{legend.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{18}\NormalTok{), }
        \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{18}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{scale\_y\_continuous}\NormalTok{(}\AttributeTok{expand =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\FloatTok{3.5}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{annotate}\NormalTok{(}\StringTok{\textquotesingle{}text\textquotesingle{}}\NormalTok{, }\AttributeTok{x =} \FloatTok{1.095}\NormalTok{, }\AttributeTok{y =} \SpecialCharTok{{-}}\FloatTok{6.5}\NormalTok{, }\AttributeTok{label =} \StringTok{\textquotesingle{}BDR\textquotesingle{}}\NormalTok{, }\AttributeTok{angle =} \SpecialCharTok{{-}}\DecValTok{85}\NormalTok{, }\AttributeTok{size =} \DecValTok{4}\NormalTok{)}

\NormalTok{morphology\_comparison\_prob2}\FloatTok{.5} \OtherTok{\textless{}{-}}\NormalTok{ morphology\_comparison\_prob2 }\SpecialCharTok{+} \FunctionTok{new\_scale\_fill}\NormalTok{()}

\NormalTok{morphology\_comparison\_prob\_final }\OtherTok{\textless{}{-}} \FunctionTok{gheatmap}\NormalTok{(morphology\_comparison\_prob2}\FloatTok{.5}\NormalTok{, }
\NormalTok{                                             my\_prey\_prob[ ,}\StringTok{\textquotesingle{}eye\_body\_r\textquotesingle{}}\NormalTok{,}\AttributeTok{drop=}\ConstantTok{FALSE}\NormalTok{], }
                                             \AttributeTok{offset=}\FloatTok{0.10}\NormalTok{, }\AttributeTok{width=}\FloatTok{0.05}\NormalTok{, }\AttributeTok{colnames =}\NormalTok{ F) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_viridis\_c}\NormalTok{(}\AttributeTok{name =} \StringTok{"Eye{-}Body Ratio (EBR)"}\NormalTok{, }
                       \AttributeTok{option =} \StringTok{\textquotesingle{}C\textquotesingle{}}\NormalTok{,}
                       \AttributeTok{limits=}\FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{3}\NormalTok{), }
                       \AttributeTok{oob =}\NormalTok{ scales}\SpecialCharTok{::}\NormalTok{squish, }
                       \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{),}
                       \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\StringTok{"3+"}\NormalTok{), }
                       \AttributeTok{na.value =} \StringTok{\textquotesingle{}grey\textquotesingle{}}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \FunctionTok{c}\NormalTok{(}\FloatTok{1.05}\NormalTok{,}\FloatTok{0.5}\NormalTok{),}
        \AttributeTok{legend.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{18}\NormalTok{), }
        \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{18}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{scale\_y\_continuous}\NormalTok{(}\AttributeTok{expand =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\FloatTok{3.5}\NormalTok{))}\SpecialCharTok{+}
\FunctionTok{annotate}\NormalTok{(}\StringTok{\textquotesingle{}text\textquotesingle{}}\NormalTok{, }\AttributeTok{x =} \FloatTok{1.15}\NormalTok{, }\AttributeTok{y =} \SpecialCharTok{{-}}\FloatTok{6.5}\NormalTok{, }\AttributeTok{label =} \StringTok{\textquotesingle{}EBR\textquotesingle{}}\NormalTok{, }\AttributeTok{angle =} \SpecialCharTok{{-}}\DecValTok{85}\NormalTok{, }\AttributeTok{size =} \DecValTok{4}\NormalTok{)}

\NormalTok{morphology\_comparison\_prob\_final}
\end{Highlighting}
\end{Shaded}

\includegraphics{Albacore_synthesis_a_phylo_files/figure-latex/Figure J Morpholigical - shape-1.pdf}

For morphological (defense/avoidance) traits use: phys\_defense,
countershade, col\_disrupt, silver and transparent (in that order)

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{morphology\_binary\_prob1 }\OtherTok{\textless{}{-}} \FunctionTok{gheatmap}\NormalTok{(prob\_basic, my\_prey\_prob[ ,}\StringTok{\textquotesingle{}phys\_defense\textquotesingle{}}\NormalTok{,}\AttributeTok{drop=}\ConstantTok{FALSE}\NormalTok{], }\AttributeTok{offset=}\DecValTok{0}\NormalTok{, }\AttributeTok{width=}\FloatTok{0.05}\NormalTok{, }\AttributeTok{colnames =}\NormalTok{ F) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_viridis\_d}\NormalTok{(}\AttributeTok{name =} \StringTok{"Physical Defence"}\NormalTok{, }\CommentTok{\#"\textbackslash{}nCountershading\textbackslash{}nColour disruption\textbackslash{}nSilver\textbackslash{}nTransparent",}
                       \AttributeTok{option =} \StringTok{\textquotesingle{}C\textquotesingle{}}\NormalTok{,}
                       \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}\StringTok{"1"}\NormalTok{, }\StringTok{"0"}\NormalTok{),}
                       \AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\StringTok{"1"}\NormalTok{, }\StringTok{"0"}\NormalTok{),}
                       \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"yes"}\NormalTok{, }\StringTok{"no"}\NormalTok{),}
                       \AttributeTok{begin=}\FloatTok{0.5}\NormalTok{, }\AttributeTok{end=}\FloatTok{0.1}\NormalTok{, }
                       \AttributeTok{na.value =} \StringTok{\textquotesingle{}grey\textquotesingle{}}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{scale\_y\_continuous}\NormalTok{(}\AttributeTok{expand =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\FloatTok{4.5}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{annotate}\NormalTok{(}\StringTok{\textquotesingle{}text\textquotesingle{}}\NormalTok{, }\AttributeTok{x =} \FloatTok{1.04}\NormalTok{, }\AttributeTok{y =} \SpecialCharTok{{-}}\FloatTok{8.5}\NormalTok{, }\AttributeTok{label =} \StringTok{\textquotesingle{}Physical Defence\textquotesingle{}}\NormalTok{, }\AttributeTok{angle =} \SpecialCharTok{{-}}\DecValTok{85}\NormalTok{, }\AttributeTok{size =} \DecValTok{3}\NormalTok{)}

\NormalTok{morphology\_binary\_prob2 }\OtherTok{\textless{}{-}} \FunctionTok{gheatmap}\NormalTok{(morphology\_binary\_prob1, my\_prey\_prob[ ,}\StringTok{\textquotesingle{}countershade\textquotesingle{}}\NormalTok{,}\AttributeTok{drop=}\ConstantTok{FALSE}\NormalTok{], }
                                    \AttributeTok{offset=}\FloatTok{0.05}\NormalTok{, }\AttributeTok{width=}\FloatTok{0.05}\NormalTok{, }\AttributeTok{colnames =}\NormalTok{ F) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_viridis\_d}\NormalTok{(}\AttributeTok{name =} \StringTok{"Physical Defence}\SpecialCharTok{\textbackslash{}n}\StringTok{Countershading"}\NormalTok{, }\CommentTok{\#"\textbackslash{}nColour disruption\textbackslash{}nSilver\textbackslash{}nTransparent", }
                       \AttributeTok{option =} \StringTok{\textquotesingle{}C\textquotesingle{}}\NormalTok{,}
                       \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}\StringTok{"1"}\NormalTok{, }\StringTok{"0"}\NormalTok{),}
                       \AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\StringTok{"1"}\NormalTok{, }\StringTok{"0"}\NormalTok{),}
                       \AttributeTok{begin=}\FloatTok{0.5}\NormalTok{, }\AttributeTok{end=}\FloatTok{0.1}\NormalTok{, }
                       \AttributeTok{na.value =} \StringTok{\textquotesingle{}grey\textquotesingle{}}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{scale\_y\_continuous}\NormalTok{(}\AttributeTok{expand =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\FloatTok{4.5}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{annotate}\NormalTok{(}\StringTok{\textquotesingle{}text\textquotesingle{}}\NormalTok{, }\AttributeTok{x =} \FloatTok{1.09}\NormalTok{, }\AttributeTok{y =} \SpecialCharTok{{-}}\FloatTok{8.5}\NormalTok{, }\AttributeTok{label =} \StringTok{\textquotesingle{}Countershading\textquotesingle{}}\NormalTok{, }\AttributeTok{angle =} \SpecialCharTok{{-}}\DecValTok{85}\NormalTok{, }\AttributeTok{size =} \DecValTok{3}\NormalTok{)}

\NormalTok{morphology\_binary\_prob3 }\OtherTok{\textless{}{-}} \FunctionTok{gheatmap}\NormalTok{(morphology\_binary\_prob2, my\_prey\_prob[ ,}\StringTok{\textquotesingle{}col\_disrupt\textquotesingle{}}\NormalTok{,}\AttributeTok{drop=}\ConstantTok{FALSE}\NormalTok{],}
                                    \AttributeTok{offset=}\FloatTok{0.10}\NormalTok{, }\AttributeTok{width=}\FloatTok{0.05}\NormalTok{, }\AttributeTok{colnames =}\NormalTok{ F) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_viridis\_d}\NormalTok{(}\AttributeTok{name =} \StringTok{"Physical Defence}\SpecialCharTok{\textbackslash{}n}\StringTok{Countershading}\SpecialCharTok{\textbackslash{}n}\StringTok{Colour disruption"}\NormalTok{, }\CommentTok{\#"\textbackslash{}nSilver\textbackslash{}nTransparent", }
                       \AttributeTok{option =} \StringTok{\textquotesingle{}C\textquotesingle{}}\NormalTok{,}
                       \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}\StringTok{"1"}\NormalTok{, }\StringTok{"0"}\NormalTok{),}
                       \AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\StringTok{"1"}\NormalTok{, }\StringTok{"0"}\NormalTok{),}
                       \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"yes"}\NormalTok{, }\StringTok{"no"}\NormalTok{),}
                       \AttributeTok{begin=}\FloatTok{0.5}\NormalTok{, }\AttributeTok{end=}\FloatTok{0.1}\NormalTok{, }
                       \AttributeTok{na.value =} \StringTok{\textquotesingle{}grey\textquotesingle{}}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{scale\_y\_continuous}\NormalTok{(}\AttributeTok{expand =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\FloatTok{4.5}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{annotate}\NormalTok{(}\StringTok{\textquotesingle{}text\textquotesingle{}}\NormalTok{, }\AttributeTok{x =} \FloatTok{1.14}\NormalTok{, }\AttributeTok{y =} \SpecialCharTok{{-}}\FloatTok{8.5}\NormalTok{, }\AttributeTok{label =} \StringTok{\textquotesingle{}Colour Disruption\textquotesingle{}}\NormalTok{, }\AttributeTok{angle =} \SpecialCharTok{{-}}\DecValTok{85}\NormalTok{, }\AttributeTok{size =} \DecValTok{3}\NormalTok{)}

\NormalTok{morphology\_binary\_prob4 }\OtherTok{\textless{}{-}} \FunctionTok{gheatmap}\NormalTok{(morphology\_binary\_prob3, my\_prey\_prob[ ,}\StringTok{\textquotesingle{}silver\textquotesingle{}}\NormalTok{,}\AttributeTok{drop=}\ConstantTok{FALSE}\NormalTok{], }
                                    \AttributeTok{offset=}\FloatTok{0.15}\NormalTok{, }\AttributeTok{width=}\FloatTok{0.05}\NormalTok{, }\AttributeTok{colnames =}\NormalTok{ F) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_viridis\_d}\NormalTok{(}\AttributeTok{name =} \StringTok{"Physical Defence}\SpecialCharTok{\textbackslash{}n}\StringTok{Countershading}\SpecialCharTok{\textbackslash{}n}\StringTok{Colour disruption}\SpecialCharTok{\textbackslash{}n}\StringTok{Silver"}\NormalTok{, }\CommentTok{\#"\textbackslash{}nTransparent", }
                       \AttributeTok{option =} \StringTok{\textquotesingle{}C\textquotesingle{}}\NormalTok{,}
                       \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}\StringTok{"1"}\NormalTok{, }\StringTok{"0"}\NormalTok{),}
                       \AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\StringTok{"1"}\NormalTok{, }\StringTok{"0"}\NormalTok{),}
                       \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"yes"}\NormalTok{, }\StringTok{"no"}\NormalTok{),}
                       \AttributeTok{begin=}\FloatTok{0.5}\NormalTok{, }\AttributeTok{end=}\FloatTok{0.1}\NormalTok{, }
                       \AttributeTok{na.value =} \StringTok{\textquotesingle{}grey\textquotesingle{}}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{scale\_y\_continuous}\NormalTok{(}\AttributeTok{expand =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\FloatTok{4.5}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{annotate}\NormalTok{(}\StringTok{\textquotesingle{}text\textquotesingle{}}\NormalTok{, }\AttributeTok{x =} \FloatTok{1.19}\NormalTok{, }\AttributeTok{y =} \SpecialCharTok{{-}}\FloatTok{8.5}\NormalTok{, }\AttributeTok{label =} \StringTok{\textquotesingle{}Silver\textquotesingle{}}\NormalTok{, }\AttributeTok{angle =} \SpecialCharTok{{-}}\DecValTok{85}\NormalTok{, }\AttributeTok{size =} \DecValTok{3}\NormalTok{)}

\NormalTok{morphology\_binary\_prob\_final }\OtherTok{\textless{}{-}} \FunctionTok{gheatmap}\NormalTok{(morphology\_binary\_prob4, my\_prey\_prob[ ,}\StringTok{\textquotesingle{}transparent\textquotesingle{}}\NormalTok{,}\AttributeTok{drop=}\ConstantTok{FALSE}\NormalTok{], }
                                         \AttributeTok{offset=}\FloatTok{0.20}\NormalTok{, }\AttributeTok{width=}\FloatTok{0.05}\NormalTok{, }\AttributeTok{colnames =}\NormalTok{ F) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_viridis\_d}\NormalTok{(}\AttributeTok{name =} \StringTok{"Physical Defence}\SpecialCharTok{\textbackslash{}n}\StringTok{Countershading}\SpecialCharTok{\textbackslash{}n}\StringTok{Colour disruption}\SpecialCharTok{\textbackslash{}n}\StringTok{Silver}\SpecialCharTok{\textbackslash{}n}\StringTok{Transparent"}\NormalTok{, }
                       \AttributeTok{option =} \StringTok{\textquotesingle{}C\textquotesingle{}}\NormalTok{,}
                       \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}\StringTok{"1"}\NormalTok{, }\StringTok{"0"}\NormalTok{),}
                       \AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\StringTok{"1"}\NormalTok{, }\StringTok{"0"}\NormalTok{),}
                       \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"yes"}\NormalTok{, }\StringTok{"no"}\NormalTok{),}
                       \AttributeTok{begin=}\FloatTok{0.5}\NormalTok{, }\AttributeTok{end=}\FloatTok{0.1}\NormalTok{, }
                       \AttributeTok{na.value =} \StringTok{\textquotesingle{}grey\textquotesingle{}}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{scale\_y\_continuous}\NormalTok{(}\AttributeTok{expand =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\FloatTok{4.5}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{annotate}\NormalTok{(}\StringTok{\textquotesingle{}text\textquotesingle{}}\NormalTok{, }\AttributeTok{x =} \FloatTok{1.24}\NormalTok{, }\AttributeTok{y =} \SpecialCharTok{{-}}\FloatTok{8.5}\NormalTok{, }\AttributeTok{label =} \StringTok{\textquotesingle{}Transparent\textquotesingle{}}\NormalTok{, }\AttributeTok{angle =} \SpecialCharTok{{-}}\DecValTok{85}\NormalTok{, }\AttributeTok{size =} \DecValTok{3}\NormalTok{)}

\NormalTok{morphology\_binary\_prob\_final}
\end{Highlighting}
\end{Shaded}

\includegraphics{Albacore_synthesis_a_phylo_files/figure-latex/Figure K Morphological - defense/avoid-1.pdf}

For Prey nutritional quality use: energy\_density, percent\_protein,
percent\_lipid

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{nutritional\_quality\_prob1 }\OtherTok{\textless{}{-}} \FunctionTok{gheatmap}\NormalTok{(prob\_basic, my\_prey\_prob[,}\StringTok{\textquotesingle{}energy\_density\textquotesingle{}}\NormalTok{,}\AttributeTok{drop=}\ConstantTok{FALSE}\NormalTok{], }
                                      \AttributeTok{offset=}\DecValTok{0}\NormalTok{, }\AttributeTok{width=}\FloatTok{0.05}\NormalTok{, }\AttributeTok{colnames =}\NormalTok{ F) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_viridis\_c}\NormalTok{(}\AttributeTok{name =} \StringTok{"Energy density (unit)"}\NormalTok{, }
                       \AttributeTok{na.value =} \StringTok{\textquotesingle{}grey\textquotesingle{}}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{scale\_y\_continuous}\NormalTok{(}\AttributeTok{expand =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\FloatTok{3.5}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{annotate}\NormalTok{(}\StringTok{\textquotesingle{}text\textquotesingle{}}\NormalTok{, }\AttributeTok{x =} \FloatTok{1.04}\NormalTok{, }\AttributeTok{y =} \SpecialCharTok{{-}}\FloatTok{6.5}\NormalTok{, }\AttributeTok{label =} \StringTok{\textquotesingle{}Energy density\textquotesingle{}}\NormalTok{, }\AttributeTok{angle =} \SpecialCharTok{{-}}\DecValTok{85}\NormalTok{, }\AttributeTok{size =} \DecValTok{3}\NormalTok{)}

\NormalTok{nutritional\_quality\_prob1}\FloatTok{.5} \OtherTok{\textless{}{-}}\NormalTok{ nutritional\_quality\_prob1 }\SpecialCharTok{+} \FunctionTok{new\_scale\_fill}\NormalTok{()}

\NormalTok{nutritional\_quality\_prob2 }\OtherTok{\textless{}{-}} \FunctionTok{gheatmap}\NormalTok{(nutritional\_quality\_prob1}\FloatTok{.5}\NormalTok{, my\_prey\_prob[,}\StringTok{"percent\_protein"}\NormalTok{,}\AttributeTok{drop=}\ConstantTok{FALSE}\NormalTok{], }
                                      \AttributeTok{offset=}\FloatTok{0.05}\NormalTok{, }\AttributeTok{width=}\FloatTok{0.05}\NormalTok{, }\AttributeTok{colnames =}\NormalTok{ F) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_viridis\_c}\NormalTok{(}\AttributeTok{name =} \StringTok{"Percent protein (\%)"}\NormalTok{, }
                       \AttributeTok{na.value =} \StringTok{\textquotesingle{}grey\textquotesingle{}}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{scale\_y\_continuous}\NormalTok{(}\AttributeTok{expand =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\FloatTok{3.5}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{annotate}\NormalTok{(}\StringTok{\textquotesingle{}text\textquotesingle{}}\NormalTok{, }\AttributeTok{x =} \FloatTok{1.09}\NormalTok{, }\AttributeTok{y =} \SpecialCharTok{{-}}\FloatTok{6.5}\NormalTok{, }\AttributeTok{label =} \StringTok{\textquotesingle{}Percent protein (\%)\textquotesingle{}}\NormalTok{, }\AttributeTok{angle =} \SpecialCharTok{{-}}\DecValTok{85}\NormalTok{, }\AttributeTok{size =} \DecValTok{3}\NormalTok{)}

\NormalTok{nutritional\_quality\_prob2}\FloatTok{.5} \OtherTok{\textless{}{-}}\NormalTok{ nutritional\_quality\_prob2 }\SpecialCharTok{+} \FunctionTok{new\_scale\_fill}\NormalTok{()}

\NormalTok{nutritional\_quality\_prob\_final }\OtherTok{\textless{}{-}} \FunctionTok{gheatmap}\NormalTok{(nutritional\_quality\_prob2}\FloatTok{.5}\NormalTok{, my\_prey\_prob[ ,}\StringTok{\textquotesingle{}percent\_lipid\textquotesingle{}}\NormalTok{,}\AttributeTok{drop=}\ConstantTok{FALSE}\NormalTok{], }
                                           \AttributeTok{offset=}\FloatTok{0.10}\NormalTok{, }\AttributeTok{width=}\FloatTok{0.05}\NormalTok{, }\AttributeTok{colnames =}\NormalTok{ F) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_viridis\_c}\NormalTok{(}\AttributeTok{name =} \StringTok{"Percent lipid (\%)"}\NormalTok{, }
                       \AttributeTok{na.value =} \StringTok{\textquotesingle{}grey\textquotesingle{}}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\FloatTok{0.5985}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{scale\_y\_continuous}\NormalTok{(}\AttributeTok{expand =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{4}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{annotate}\NormalTok{(}\StringTok{\textquotesingle{}text\textquotesingle{}}\NormalTok{, }\AttributeTok{x =} \FloatTok{1.14}\NormalTok{, }\AttributeTok{y =} \SpecialCharTok{{-}}\FloatTok{6.5}\NormalTok{, }\AttributeTok{label =} \StringTok{\textquotesingle{}Percent lipid (\%)\textquotesingle{}}\NormalTok{, }\AttributeTok{angle =} \SpecialCharTok{{-}}\DecValTok{85}\NormalTok{, }\AttributeTok{size =} \DecValTok{3}\NormalTok{)}

\NormalTok{nutritional\_quality\_prob\_final }
\end{Highlighting}
\end{Shaded}

\includegraphics{Albacore_synthesis_a_phylo_files/figure-latex/Figure L Prey Nutritional Quality-1.pdf}

For Fisheries status use: fisheries\_status

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fishery\_prob }\OtherTok{\textless{}{-}} \FunctionTok{gheatmap}\NormalTok{(prob\_basic, my\_prey\_prob[ ,}\StringTok{\textquotesingle{}fisheries\_status\textquotesingle{}}\NormalTok{,}\AttributeTok{drop=}\ConstantTok{FALSE}\NormalTok{], }
                         \AttributeTok{offset=}\DecValTok{0}\NormalTok{, }\AttributeTok{width=}\FloatTok{0.05}\NormalTok{,}\AttributeTok{font.size=}\DecValTok{2}\NormalTok{, }\AttributeTok{colnames =}\NormalTok{ F) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_viridis\_d}\NormalTok{(}\AttributeTok{name =} \StringTok{"Fisheries status (FS)"}\NormalTok{, }
                       \AttributeTok{option =} \StringTok{\textquotesingle{}C\textquotesingle{}}\NormalTok{,}
                       \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}\StringTok{"none"}\NormalTok{,}\StringTok{"aquarium"}\NormalTok{, }\StringTok{"aquaculture"}\NormalTok{, }\StringTok{"potential"}\NormalTok{,}\StringTok{"minor commercial"}\NormalTok{,}
                                  \StringTok{"commercial"}\NormalTok{, }\StringTok{"highly commercial"}\NormalTok{),}
                       \AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\StringTok{"none"}\NormalTok{,}\StringTok{"aquarium"}\NormalTok{, }\StringTok{"aquaculture"}\NormalTok{, }\StringTok{"potential"}\NormalTok{,}\StringTok{"minor commercial"}\NormalTok{,}
                                  \StringTok{"commercial"}\NormalTok{, }\StringTok{"highly commercial"}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{scale\_y\_continuous}\NormalTok{(}\AttributeTok{expand =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\FloatTok{3.5}\NormalTok{))}\SpecialCharTok{+}
  \FunctionTok{annotate}\NormalTok{(}\StringTok{\textquotesingle{}text\textquotesingle{}}\NormalTok{, }\AttributeTok{x =} \FloatTok{1.04}\NormalTok{, }\AttributeTok{y =} \SpecialCharTok{{-}}\FloatTok{6.5}\NormalTok{, }\AttributeTok{label =} \StringTok{\textquotesingle{}FS\textquotesingle{}}\NormalTok{, }\AttributeTok{angle =} \SpecialCharTok{{-}}\DecValTok{85}\NormalTok{, }\AttributeTok{size =} \DecValTok{3}\NormalTok{)}

\NormalTok{fishery\_prob}
\end{Highlighting}
\end{Shaded}

\includegraphics{Albacore_synthesis_a_phylo_files/figure-latex/Figure M Fisheries Status-1.pdf}

\hypertarget{extras}{%
\subsubsection{EXTRAS}\label{extras}}

\textbf{Prey Order \& Fam -- TO DO:}

Code for these graphs are included in the .Rmd and not in the published
document. These graphs are currently a lower priority and we may not get
to this, however we include the code for anyone interested. The
following would need to be fixed to improve the graphs:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Legends are too large as they are. I suggest not changing the colours
  as they clearly show different groups just not which ones are which
  using the legend. Is there any way to plot the ``order'' names near
  the branch of the tree or in a ring around the tree?
\item
  Also fix legend labels.
\end{enumerate}

\hypertarget{saving-output}{%
\subsection{SAVING OUTPUT}\label{saving-output}}

There are numerous issues with saving output either via ggsave() or
dev.copy2pdf() functions. I'm batching the output saves below and doing
all at once.

\textbf{Basic phylogeny}

Including code for saving this graph. Code for saving output for all
other figures below are included in the .Rmd and not in the rendered
document.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#Basic phylogenies}

\CommentTok{\#ggsave("prob\_basic.png",}
  \CommentTok{\#here(\textquotesingle{}./output\_figures/phylos/prey\_prob/prob\_basic.png\textquotesingle{}), }
\CommentTok{\#  plot=prob\_basic, width=8, height=8, dpi=300)}

\CommentTok{\#ggsave("prob\_basic\_lab.png",}
  \CommentTok{\#here(\textquotesingle{}./output\_figures/phylos/prey\_prob/prob\_basic\_lab.png\textquotesingle{}), }
\CommentTok{\#  plot=prob\_basic\_lab, width=10, height=10, dpi=300)}
\end{Highlighting}
\end{Shaded}

\textbf{Phylogeny by Class}

\textbf{Phylogeny by diet use}

\textbf{Phylogeny by habitat Use Traits}

\textbf{Phylogeny by behaviour \& habitat use}

\textbf{Phylogeny by morphology - shape}

\textbf{Phylogeny by defensive morphology}

\textbf{Phylogeny by nutritional quality}

\textbf{Phylogeny by fisheries status}

\end{document}
