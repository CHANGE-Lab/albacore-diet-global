---
title: "Albacore Diet Synthesis C"
author: "Natasha Hardy"
date: "15/04/2021"
output:
  pdf_document: default
  html_document: default
---

# Trait variation in albacore diet across geographies

## About

This document contains code for loading mostly manipulated data for global albacore prey communities consumed and for conducting multivariate community analyses and traitglm on albacore diets across ocean basins, using habitat association, gregariousness traits and cluster # output from cluster analyses.

## Workspace

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#library("rstudioapi")
#setwd(dirname(getActiveDocumentContext()$path))
```

```{r Workspace, echo=FALSE, message=FALSE, results='hide'}
#If need to clear 'Environment'
#First view environment if you like
#ls()
#To clear your environment
#remove(list = ls())

getwd()

# general
library(tidyverse)
library(readxl)
library(plyr)
library(dplyr)
library(devtools)
library(reshape2)
library(here)
"%notin%" = Negate('%in%')
here::here()
library(pander)

# graphics
library(ggplot2)
library(lattice)
library(graphics)
library(RColorBrewer)
library(gridExtra)
library(captioner)
library(viridis)
library("grid")
library("ggplotify")


#modelling
library(Hmisc)
library(mgcv)
library(unmarked)
library(lme4)
library(mvabund)
library(tweedie)
library(vegan)

## mvabund bug source code
source("traitglm.R")
source("get_polys.R")

```



## Data needs

- Species (L): alb_prob_preyPA ==> "./data/output_data/alb_prob_preyPA_use.csv"

- Env/Site (R): alb_prob_covars ==> "./data/output_data/alb_prob_covars_use.csv"

- Traits (Q): alb_prob_traits ==> "./data/output_data/alb_prob_traits_use.csv"

### Load DFs for analyses

```{r Load Prey data (L)}

#L - species df
alb_prob_preyPA = read.csv(here("./data/output_data/alb_prob_preyPA_use.csv")) %>%
  dplyr::select(-X)
#Currently imported with sites as rows
#Data are integers, could be numeric if modelling issues

#Example code
#alb_adult_prey[,1:ncol(alb_adult_prey)] =  lapply(alb_adult_prey[,1:ncol(alb_adult_prey)], as.numeric)

dim(alb_prob_preyPA) #225 obs, 123 species
```

```{r Load Covar data (R)}

#R - covars df
alb_prob_covars = read.csv(here("./data/output_data/alb_prob_covars_use.csv")) %>%
  dplyr::select(-X)
#Currently imported with sites as rows

#As factors
alb_prob_covars[,1:ncol(alb_prob_covars)] =  lapply(alb_prob_covars[,1:ncol(alb_prob_covars)], as.factor)

```

```{r Load Trait data (Q)}

#Q - trait df
alb_prob_traits = read.csv(here("./data/output_data/alb_prob_traits_use.csv"))%>%
  dplyr::select(-X)

#Needs species as rows
#Assign speces as rownames
rownames(alb_prob_traits) <- alb_prob_traits$prey_sp
#Order species list if needed
alb_prob_traits <- alb_prob_traits[ order(row.names(alb_prob_traits)), ]
#Traits as factors for analyses
alb_prob_traits[,1:ncol(alb_prob_traits)] =  lapply(alb_prob_traits[,1:ncol(alb_prob_traits)], as.factor)

dim(alb_prob_traits) #123  17

```

## DF Checks

**Traits**

Check trait values distribution if needed.

```{r Trait values check, eval=FALSE, warning=FALSE, message=FALSE}
summary(alb_prob_traits$life_stage)

summary(alb_prob_traits$vert_habitat) #merge bathypelagic and mesopelagic

summary(alb_prob_traits$horz_habitat) #potential merger of continental shelf/slope, and coastal/reef assoc.

summary(alb_prob_traits$diel_migrant_cat)

summary(alb_prob_traits$season_cat)

summary(alb_prob_traits$gregarious)

summary(alb_prob_traits$prob.clust.num) #low numbers in cluster #8 = 2

```

Trait variable levels look good.

```{r Trait factor levels, warning=FALSE, message=FALSE}

levels(alb_prob_traits$vert_habitat) #check

levels(alb_prob_traits$horz_habitat) #check

levels(alb_prob_traits$gregarious) #check

```

**Covars**

```{r Covars values check, eval=FALSE}

#Summary stats on covars
unique(alb_prob_covars$StudyID) #22 studies
unique(alb_prob_covars$OceanBasin) #6 Ocean basins
unique(alb_adult_fo$OceanBasinQ) #10 Ocean basin quarters, but data gets thin for many
unique(alb_prob_covars$YearEnd) #~27 years (or groups of years) are represented in this study
unique(alb_prob_covars$code) #10 Longhurst provinces represented, similar to Ocean Basin Q but also gets thin
unique(alb_prob_covars$pred_life) #

```

We'll be using the best covars based on balance and replication ==> pred_life, OceanBasin, lat_cat.

```{r Covar factor levels, eval=FALSE}
#Check representation
#summary(alb_adult_covars)

summary(alb_prob_covars$lat_cat)
#temperate  tropical 
#   178        31 

summary(alb_prob_covars$pred_life)
#   adult juvenile    mixed 
#     54       62      93 
#Predator life stage
alb_prob_covars$pred_life <- factor(alb_prob_covars$pred_life, 
                                            levels = c("mixed", "adult", "juvenile"))
#Check
#levels(alb_prob_covars$pred_life)


summary(alb_prob_covars$OceanBasin)
#           Indian Mediterranean    N Atlantic     N Pacific    S Atlantic     S Pacific 
#            15            29            78            62            8            17 

#Select some covars & traits
alb_prob_covars$OceanBasin <- factor(alb_prob_covars$OceanBasin, levels = c("Mediterranean", "N Atlantic", "S Atlantic", "N Pacific", "S Pacific", "Indian"))
#Check
#levels(alb_prob_covars$OceanBasin)


summary(alb_prob_covars$OceanBasinQ)
#Not going to use

summary(alb_prob_covars$code)
#Not going to use

```

## DF manips for multivariate analyses

```{r Check names and df dimensions, eval=FALSE}

## Make sure species names match abund matrix
#rownames(alb_prob_traits) == colnames(alb_prob_preyPA) #awesome!

# Then create the mvabund matrix
alb_prob_preyPA_mv = as.mvabund(alb_prob_preyPA)

#Check again that species names match trait values
#rownames(alb_prob_traits) == colnames(alb_prob_preyPA_mv) #awesome!

#Check all matrix dimensions
dim(alb_prob_traits) #123 species and 17 traits
dim(alb_prob_preyPA_mv) #209 obs, 123 species
dim(alb_prob_covars) #209 obs, 13 variables

```

```{r Select covars traits and levels}

#Species df is ready --> alb_prob_preyPA_mv

#Covars --> want to use 
#alb_prob_covars$OceanBasin
#alb_prob_covars$pred_life
#alb_prob_covars$lat_cat

#Traits - select and manipulate that df - ideally we want to use the same df here
traits_use = alb_prob_traits[,c(2:6,13,17)] %>%
  dplyr::rename(cluster = prob.clust.num) 
#All still factors
#Using all traits 
#traits_use[,1:6] 
#and just clusters

```


## TRAIT GLMS

### MODEL TALLY

**Manyglms for model comparisons**

- prob_life_spp

- prob_ocean_spp 

- prob_lat_spp

- prob_life_clusters_many

- prob_ocean_clusters_many 

- prob_life_trait_many

- prob_ocean_trait_many


**LASSO glm1path models for significance testing**

- prob_life_cluster_LASSO

- prob_ocean_cluster_LASSO

- prob_life_trait_LASSO

- prob_ocean_trait_LASSO

- prob_lat_trait_LASSO

### READ MODELS BACK IN

Species and environment matrix models - manyglm.

```{r READ IN SPP MODELS}
#/Users/tashhardy/Documents/GitHub/albacore-diet-global/outputs_figures/traitglms/prob_models

prob_life_spp = readRDS(here("outputs_figures/traitglms/prob_models/prob_life_spp.rds")) 
prob_ocean_spp = readRDS(here("outputs_figures/traitglms/prob_models/prob_ocean_spp.rds"))
prob_lat_spp = readRDS(here("outputs_figures/traitglms/prob_models/prob_lat_spp.rds"))

```

Species, cluster number and environment models - manyglms + LASSOs.

```{r READ IN CLUSTER MODELS}

#Manyglms
prob_life_clusters_many = readRDS(here("outputs_figures/traitglms/prob_models/prob_life_clusters_many.rds")) 
prob_ocean_clusters_many = readRDS(here("outputs_figures/traitglms/prob_models/prob_ocean_clusters_many.rds"))
prob_lat_clusters_many = readRDS(here("outputs_figures/traitglms/prob_models/prob_lat_clusters_many.rds"))

#LASSO glms
prob_life_cluster_LASSO = readRDS(here("outputs_figures/traitglms/prob_models/prob_life_cluster_LASSO.rds"))
prob_ocean_cluster_LASSO = readRDS(here("outputs_figures/traitglms/prob_models/prob_ocean_cluster_LASSO.rds"))
prob_lat_cluster_LASSO = readRDS(here("outputs_figures/traitglms/prob_models/prob_lat_cluster_LASSO.rds"))

```

Species, traits and environment models - manyglms + LASSOs.

```{r READ IN TRAIT MODELS}

# Manyglms
prob_life_trait_many = readRDS(here("outputs_figures/traitglms/prob_models/prob_life_trait_many.rds")) 
prob_ocean_trait_many = readRDS(here("outputs_figures/traitglms/prob_models/prob_ocean_trait_many.rds"))
prob_lat_trait_many = readRDS(here("outputs_figures/traitglms/prob_models/prob_lat_trait_many.rds"))

#LASSO glms
prob_life_trait_LASSO = readRDS(here("outputs_figures/traitglms/prob_models/prob_life_trait_LASSO.rds"))
prob_ocean_trait_LASSO = readRDS(here("outputs_figures/traitglms/prob_models/prob_ocean_trait_LASSO.rds"))
prob_lat_trait_LASSO = readRDS(here("outputs_figures/traitglms/prob_models/prob_lat_trait_LASSO.rds"))

```

Interaction models

```{r READ IN INTERACTION MODELS}
#Manyglm
prob_inter_trait_many = readRDS(here("outputs_figures/traitglms/prob_models/prob_inter_trait_many.rds"))
prob_inter_trait_many2 = readRDS(here("outputs_figures/traitglms/prob_models/prob_inter_trait_many2.rds"))

#LASSO glms
prob_inter_trait_LASSO = readRDS(here("outputs_figures/traitglms/prob_models/prob_inter_trait_LASSO.rds"))
prob_inter_trait_LASSO2 = readRDS(here("outputs_figures/traitglms/prob_models/prob_inter_trait_LASSO2.rds"))

```


### Species models

**SPP Manyglm - Predator Life Stage**
add:, eval=FALSE

```{r SPP life stage manyglm, eval=FALSE}

prob_life_spp <- traitglm(L = alb_prob_preyPA_mv,
                          R = alb_prob_covars$pred_life,
                          family=binomial(link = "logit")
                          ) #note default is "manyglm"

```

**SPP Manyglm - Ocean Basin**

```{r SPP ocean manyglm, eval=FALSE}

prob_ocean_spp <- traitglm(L = alb_prob_preyPA_mv,
                                    R = alb_prob_covars$OceanBasin,
                                    family=binomial(link = "logit")
                                    ) #note default is "manyglm"

#check model output if needed
```

**SPP Manyglm - Latitude**

```{r SPP climate manyglm, eval=FALSE}

prob_lat_spp <- traitglm(L = alb_prob_preyPA_mv,
                         R = alb_prob_covars$lat_cat,
                         family=binomial(link = "logit")
                         ) #note default is "manyglm"

#check model output if needed
```

**SPP Manyglm - Life Stage - Check multivariate model outputs**

Note that multivariate residuals look good and we have a pretty good fit.

```{r SPP life stage model eval, tidy=TRUE, message=FALSE, warning=FALSE}

#Check model output - residuals TEST
qqnorm(residuals(prob_life_spp)[which(residuals(prob_life_spp)<10000)]); abline(c(0,1),col="red")

#omit non-finite residuals FULL MODEL
resids.full = residuals(prob_life_spp)[is.finite((residuals(prob_life_spp)))]
plot(resids.full); abline(c(0,0),col="red")
```

SAVE OUTPUTS SO FAR

```{r SAVE SPP MODELS, eval=FALSE}
#/Users/tashhardy/Documents/GitHub/albacore-diet-global/outputs_figures/traitglms/prob_models

saveRDS(prob_life_spp, file = here("outputs_figures/traitglms/prob_models/prob_life_spp.rds")) 
saveRDS(prob_ocean_spp, file = here("outputs_figures/traitglms/prob_models/prob_ocean_spp.rds"))
saveRDS(prob_lat_spp, file = here("outputs_figures/traitglms/prob_models/prob_lat_spp.rds"))

```


### Trait clusters models

#### Predator Life Stage

**MANYGLM Clusters - Predator Life Stage**

Trait (cluster)*Env (life stage) - Manyglm

```{r Clusters life stage manyglm, eval=FALSE}

prob_life_clusters_many <- traitglm(L = alb_prob_preyPA_mv,
                                    R = alb_prob_covars$pred_life,
                                    Q = traits_use$cluster,
                                    family=binomial(link = "logit")
                                    ) #note default is "manyglm"

```

Note that outputs for all models look the same because residuals are the same, as we fit models to the same species and covariate datasets.

```{r Check clusters life stage manyglm output, tidy=TRUE, message=FALSE, warning=FALSE}
#Check model output - residuals TEST
qqnorm(residuals(prob_life_clusters_many)[which(residuals(prob_life_clusters_many)<10000)]); abline(c(0,1),col="red")

#omit non-finite residuals FULL MODEL
resids.full = residuals(prob_life_clusters_many)[is.finite((residuals(prob_life_clusters_many)))]
plot(resids.full); abline(c(0,0),col="red")
```

Visualise results of traitglm fit with manyglm routine, reference levels are the first cluster group and the mixed albacore life stage group.

```{r Plot clusters life manyglm, tidy=TRUE, message=FALSE, warning=FALSE}

a        = max( abs(prob_life_clusters_many$fourth.corner) )
colort   = colorRampPalette(c("blue","grey","red")) #can replace "grey" with "white"
temp = t(as.matrix(prob_life_clusters_many$fourth.corner))

rownames(temp) = c("Adult", "Juvenile")

prob_life_clusters_many_graph = levelplot(temp, 
                     xlab=list("Predator Life Stage", cex=1.5),
                     ylab=list("Species cluster", cex=1.5), 
                     col.regions=colort(100), 
                     at=seq(-a, a,length=100),
                     scales = list(x=list(rot = 45, cex=1.3), y=list(cex=1.3)), 
                     colorkey=list(labels=list(cex=1.3)))

print(prob_life_clusters_many_graph)

ggsave(here("./outputs_figures/traitglms/prob_all_simple/prob_life_clusters_many_graph.pdf"), 
       plot = as.ggplot(prob_life_clusters_many_graph), width=12, height=12, dpi=300)

ggsave(here("outputs_figures/traitglms/prob_all_simple/prob_life_clusters_many_graph.jpeg"), 
       plot = as.ggplot(prob_life_clusters_many_graph), width=12, height=12, dpi=300)

```

**GLM1PATH Clusters - Predator Life Stage**

Using method = glm1path == LASSO model.

```{r Clusters life  LASSO, eval=FALSE}

prob_life_cluster_LASSO <- traitglm(L = alb_prob_preyPA_mv,
                                    R = alb_prob_covars$pred_life,
                                    Q = traits_use$cluster,
                                    family=binomial(link = "logit"),
                                    method="glm1path"
                                    ) #note default is "manyglm"

```

**NOTE:** We do not get a lot of significant values for the clusters as a trait.

```{r Plot cluster life LASSO, tidy=TRUE, message=FALSE, warning=FALSE}

a        = max( abs(prob_life_cluster_LASSO$fourth.corner) )
colort   = colorRampPalette(c("blue","grey","red")) #can replace "grey" with "white"
temp = t(as.matrix(prob_life_cluster_LASSO$fourth.corner))

rownames(temp) = c("Mixed", "Adult", "Juvenile")

prob_life_cluster_LASSO_graph = levelplot(temp,
                                          xlab=list("Predator Life Stage", cex=1.5),
                                          ylab=list("Species clusters", cex=1.5),
                                          col.regions=colort(100),
                                          at=seq(-a, a,length=100),
                                          scales = list(x=list(rot = 45, cex=1.3), y=list(cex=1.3)),
                                          colorkey=list(labels=list(cex=1.3)))

print(prob_life_cluster_LASSO_graph)

ggsave(here("outputs_figures/traitglms/prob_all_simple/prob_life_cluster7_LASSO_graph.pdf"), 
       plot = as.ggplot(prob_life_cluster_LASSO_graph), width=12, height=12, dpi=300)

ggsave(here("outputs_figures/traitglms/prob_all_simple/prob_life_cluster7_LASSO_graph.jpeg"), 
       plot = as.ggplot(prob_life_cluster_LASSO_graph), width=12, height=12, dpi=300)

```

#### Ocean Basin

**MANYGLM Clusters - Ocean Basin**

Trait (cluster)*Env (ocean basin) - Manyglm

```{r Clusters ocean manyglm, eval=FALSE}

prob_ocean_clusters_many <- traitglm(L = alb_prob_preyPA_mv,
                                     R = alb_prob_covars$OceanBasin,
                                     Q = traits_use$cluster,
                                     family=binomial(link = "logit")
                                     ) #note default is "manyglm"

```

```{r Plot clusters ocean manyglm, tidy=TRUE, message=FALSE, warning=FALSE}

a        = max( abs(prob_ocean_clusters_many$fourth.corner) )
colort   = colorRampPalette(c("blue","grey","red")) #can replace "grey" with "white"
temp = t(as.matrix(prob_ocean_clusters_many$fourth.corner))

rownames(temp) = c(#"Mediterranean",
                   "N Atlantic",
                   "S Atlantic",
                   "N Pacific",
                   "S Pacific",
                   "Indian")

prob_ocean_clusters_many_graph = levelplot(temp, 
                     xlab=list("Ocean Basins", cex=1.5),
                     ylab=list("Species clusters", cex=1.5), 
                     col.regions=colort(100), 
                     at=seq(-a, a,length=100),
                     scales = list(x=list(rot = 45, cex=1.3), y=list(cex=1.3)), 
                     colorkey=list(labels=list(cex=1.3)))

print(prob_ocean_clusters_many_graph)

#ggsave(here("outputs_figures/traitglms/prob_all_simple/prob_ocean_clusters_many_graph.pdf"), 
#       plot = as.ggplot(prob_ocean_clusters_many_graph), width=12, height=12, dpi=300)

#ggsave(here("outputs_figures/traitglms/prob_all_simple/prob_ocean_clusters_many_graph.jpeg"), 
#       plot = as.ggplot(prob_ocean_clusters_many_graph), width=12, height=12, dpi=300)

```

**GLM1PATH Clusters - Ocean Basin**

Using method = glm1path == LASSO model.

```{r Clusters ocean LASSO, eval=FALSE}

prob_ocean_cluster_LASSO <- traitglm(L = alb_prob_preyPA_mv,
                                     R = alb_prob_covars$OceanBasin,
                                     Q = traits_use$cluster,
                                     family=binomial(link = "logit"),
                                     method="glm1path"
                                     ) #note default is "manyglm"

```

```{r Plot clusters ocean LASSO, tidy=TRUE, message=FALSE, warning=FALSE}

a        = max( abs(prob_ocean_cluster_LASSO$fourth.corner) )
colort   = colorRampPalette(c("blue","grey","red")) #can replace "grey" with "white"
temp = t(as.matrix(prob_ocean_cluster_LASSO$fourth.corner))

rownames(temp) = c("Mediterranean",
                   "N Atlantic",
                   "S Atlantic",
                   "N Pacific",
                   "S Pacific",
                   "Indian")

prob_ocean_cluster_LASSO_graph = levelplot(temp, 
                     xlab=list("Ocean Basins", cex=1.5),
                     ylab=list("Species clusters", cex=1.5), 
                     col.regions=colort(100), 
                     at=seq(-a, a,length=100),
                     scales = list(x=list(rot = 45, cex=1.3), y=list(cex=1.3)), 
                     colorkey=list(labels=list(cex=1.3)))

print(prob_ocean_cluster_LASSO_graph)

#ggsave(here("outputs_figures/traitglms/prob_all_simple/prob_ocean_cluster_LASSO_graph.pdf"), 
#       plot = as.ggplot(prob_ocean_cluster_LASSO_graph), width=12, height=12, dpi=300)

#ggsave(here("outputs_figures/traitglms/prob_all_simple/prob_ocean_cluster_LASSO_graph.jpeg"), 
#       plot = as.ggplot(prob_ocean_cluster_LASSO_graph), width=12, height=12, dpi=300)

```


#### Climate

**MANYGLM Clusters - Climate**

Trait (cluster)*Env (climate) - Manyglm

```{r Clusters latitude manyglm, eval=FALSE}

prob_lat_clusters_many <- traitglm(L = alb_prob_preyPA_mv,
                                     R = alb_prob_covars$lat_cat,
                                     Q = traits_use$cluster,
                                     family=binomial(link = "logit")
                                     ) #note default is "manyglm"

```

```{r Plot clusters latitude manyglm, tidy=TRUE, message=FALSE, warning=FALSE}

a        = max( abs(prob_lat_clusters_many$fourth.corner) )
colort   = colorRampPalette(c("blue","grey","red")) #can replace "grey" with "white"
temp = t(as.matrix(prob_lat_clusters_many$fourth.corner))

rownames(temp) = c("Tropical")

prob_lat_clusters_many_graph = levelplot(temp, 
                     xlab=list("Climate", cex=1.5),
                     ylab=list("Species clusters", cex=1.5), 
                     col.regions=colort(100), 
                     at=seq(-a, a,length=100),
                     scales = list(x=list(rot = 45, cex=1.3), y=list(cex=1.3)), 
                     colorkey=list(labels=list(cex=1.3)))

print(prob_lat_clusters_many_graph)

ggsave(here("outputs_figures/traitglms/prob_all_simple/prob_lat_clusters_many_graph.pdf"), 
       plot = as.ggplot(prob_lat_clusters_many_graph), width=12, height=12, dpi=300)

ggsave(here("outputs_figures/traitglms/prob_all_simple/prob_lat_clusters_many_graph.jpeg"), 
       plot = as.ggplot(prob_lat_clusters_many_graph), width=12, height=12, dpi=300)

```

**GLM1PATH Clusters - Cliamte**

Using method = glm1path == LASSO model.

```{r Clusters latitude LASSO, eval=FALSE}

prob_lat_cluster_LASSO <- traitglm(L = alb_prob_preyPA_mv,
                                     R = alb_prob_covars$lat_cat,
                                     Q = traits_use$cluster,
                                     family=binomial(link = "logit"),
                                     method="glm1path"
                                     ) #note default is "manyglm"

```

```{r Plot clusters latitude LASSO, tidy=TRUE, message=FALSE, warning=FALSE}

a        = max( abs(prob_lat_cluster_LASSO$fourth.corner) )
colort   = colorRampPalette(c("blue","grey","red")) #can replace "grey" with "white"
temp = t(as.matrix(prob_lat_cluster_LASSO$fourth.corner))

rownames(temp) = c("Tropical")

prob_lat_cluster_LASSO_graph = levelplot(temp, 
                     xlab=list("Climate", cex=1.5),
                     ylab=list("Species clusters", cex=1.5), 
                     col.regions=colort(100), 
                     at=seq(-a, a,length=100),
                     scales = list(x=list(rot = 45, cex=1.3), y=list(cex=1.3)), 
                     colorkey=list(labels=list(cex=1.3)))

print(prob_lat_cluster_LASSO_graph)

ggsave(here("outputs_figures/traitglms/prob_all_simple/prob_lat_cluster_LASSO_graph.pdf"), 
       plot = as.ggplot(prob_lat_cluster_LASSO_graph), width=12, height=12, dpi=300)

ggsave(here("outputs_figures/traitglms/prob_all_simple/prob_lat_cluster_LASSO_graph.jpeg"), 
       plot = as.ggplot(prob_lat_cluster_LASSO_graph), width=12, height=12, dpi=300)

```

#### SAVE CLUSTER OUTPUTS

```{r SAVE CLUSTER MODELS, eval=FALSE}
#/Users/tashhardy/Documents/GitHub/albacore-diet-global/outputs_figures/traitglms/prob_models

#Manyglms
saveRDS(prob_life_clusters_many, file = here("outputs_figures/traitglms/prob_models/prob_life_clusters_many.rds")) 
saveRDS(prob_ocean_clusters_many, file = here("outputs_figures/traitglms/prob_models/prob_ocean_clusters_many.rds"))
saveRDS(prob_lat_clusters_many, file = here("outputs_figures/traitglms/prob_models/prob_lat_clusters_many.rds"))

#LASSO glms
saveRDS(prob_life_cluster_LASSO, file = here("outputs_figures/traitglms/prob_models/prob_life_cluster_LASSO.rds"))
saveRDS(prob_ocean_cluster_LASSO, file = here("outputs_figures/traitglms/prob_models/prob_ocean_cluster_LASSO.rds"))
saveRDS(prob_lat_cluster_LASSO, file = here("outputs_figures/traitglms/prob_models/prob_lat_cluster_LASSO.rds"))

```

### Trait models

#### Predator Life Stage

**MANYGLM Trait values - Predator Life Stage**

Trait (trait matrix)*Env (life stage) - Manyglm

```{r Traits life stage manyglm, eval=FALSE}

prob_life_trait_many <- traitglm(L = alb_prob_preyPA_mv,
                                 R = alb_prob_covars$pred_life,
                                 Q = traits_use[,1:6],
                                    #traits_use_try,
                                 family=binomial(link = "logit")
                                    ) #note default is "manyglm"

```

```{r Plot traits life stage manyglm, tidy=TRUE, message=FALSE, warning=FALSE}

a        = max( abs(prob_life_trait_many$fourth.corner) )
colort   = colorRampPalette(c("blue","grey","red")) #can replace "grey" with "white"
temp = t(as.matrix(prob_life_trait_many$fourth.corner))

#rownames(temp) = c("Adult", "Juvenile", "Mixed")
#colnames(temp) = c("Vert. habitat - benthic",
#                   "Vert. habitat - demersal",
#                   "Vert. habitat - epipelagic",
#                   "Vert. habitat - mesopelagic",
#                   "Vert. habitat - bathypelagic",
#                   "Horz. habitat - reef-associated",
#                   "Horz. habitat - coastal",
#                   "Horz. habitat - continental shelf",
#                   "Horz. habitat - continental slope",
#                   "Horz. habitat - oceanic",
#                   "Diel migrant (yes)",
#                   "Seasonal migrant (yes)",
#                   "Gregarious - schooling")

prob_life_many_4th = levelplot(temp, 
                     xlab=list("Predator Life Stage", cex=1.5),
                     ylab=list("Species traits", cex=1.5), 
                     col.regions=colort(100), 
                     at=seq(-a, a,length=100),
                     scales = list(x=list(rot = 45, cex=1.3), y=list(cex=1.3)), 
                     colorkey=list(labels=list(cex=1.3)))

print(prob_life_many_4th)

ggsave(here("outputs_figures/traitglms/prob_all_simple/prob_life_many_4th.pdf"), plot = as.ggplot(prob_life_many_4th), width=12, height=12, dpi=300)

ggsave(here("outputs_figures/traitglms/prob_all_simple/prob_life_many_4th_graph.jpeg"), 
       plot = as.ggplot(prob_ocean_cluster_LASSO_graph), width=12, height=12, dpi=300)

#dev.copy2pdf(file=here("./outputs_figures/traitglms/fourth_lifestage.png"), width=12, height=5)

```

**GLM1PATH Trait values - Predator Life Stage**

Using method = glm1path == LASSO model.

```{r Traits life stage LASSO, eval=FALSE}

prob_life_trait_LASSO <- traitglm(L = alb_prob_preyPA_mv,
                                 R = alb_prob_covars$pred_life,
                                 Q = traits_use[,1:6],
                                 family=binomial(link = "logit"),
                                 method="glm1path"
                                 ) #note default is "manyglm"

```

```{r Plot traits life LASSO, tidy=TRUE, message=FALSE, warning=FALSE}

a        = max( abs(prob_life_trait_LASSO$fourth.corner) )
colort   = colorRampPalette(c("blue","grey","red")) #can replace "grey" with "white"
temp = t(as.matrix(prob_life_trait_LASSO$fourth.corner))

rownames(temp) = c("Mixed", "Adult", "Juvenile")
colnames(temp) = c("Prey life: juvenile",
                   "Vert. habitat - benthic",
                   "Vert. habitat - demersal",
                   "Vert. habitat - epipelagic",
                   "Vert. habitat - mesopelagic",
                   "Horz. habitat - coastal",
                   "Horz. habitat - continental shelf",
                   "Horz. habitat - oceanic",
                   "Diel migrant (yes)",
                   "Seasonal migrant (yes)",
                   "Gregarious - schooling")

prob_life_LASSO_graph = levelplot(temp, 
                     xlab=list("Predator Life Stage", cex=1.5),
                     ylab=list("Species traits", cex=1.5), 
                     col.regions=colort(100), 
                     at=seq(-a, a,length=100),
                     scales = list(x=list(rot = 45, cex=1.3), y=list(cex=1.3)), 
                     colorkey=list(labels=list(cex=1.3)))

print(prob_life_LASSO_graph)

ggsave(here("outputs_figures/traitglms/prob_all_simple/prob_life_LASSO_graph.pdf"), 
       plot = as.ggplot(prob_life_LASSO_graph), width=12, height=12, dpi=300)

ggsave(here("outputs_figures/traitglms/prob_all_simple/prob_life_LASSO_graph.jpeg"), 
       plot = as.ggplot(prob_life_LASSO_graph), width=12, height=12, dpi=300)

```

#### Ocean Basin

**MANYGLM Trait values - Ocean Basin**

Trait (trait matrix)*Env (ocean basin) - Manyglm

```{r Traits ocean manyglm, eval=FALSE}

prob_ocean_trait_many <- traitglm(L = alb_prob_preyPA_mv,
                                 R = alb_prob_covars$OceanBasin,
                                 Q = traits_use[,1:6],
                                 family=binomial(link = "logit")
                                    ) #note default is "manyglm"

```

```{r Plot traits ocean manyglm, tidy=TRUE, message=FALSE, warning=FALSE}

a        = max( abs(prob_ocean_trait_many$fourth.corner) )
colort   = colorRampPalette(c("blue","grey","red")) #can replace "grey" with "white"
temp = t(as.matrix(prob_ocean_trait_many$fourth.corner))

rownames(temp) = c(#"Mediterranean",
                   "N Atlantic",
                   "S Atlantic",
                   "N Pacific",
                   "S Pacific",
                   "Indian")

prob_ocean_trait_many_graph = levelplot(temp, 
                     xlab=list("Ocean Basins", cex=1.5),
                     ylab=list("Species traits", cex=1.5), 
                     col.regions=colort(100), 
                     at=seq(-a, a,length=100),
                     scales = list(x=list(rot = 45, cex=1.3), y=list(cex=1.3)), 
                     colorkey=list(labels=list(cex=1.3)))

print(prob_ocean_trait_many_graph)

ggsave(here("outputs_figures/traitglms/prob_all_simple/prob_ocean_trait_many_graph.pdf"), 
       plot = as.ggplot(prob_ocean_trait_many_graph), width=12, height=12, dpi=300)

ggsave(here("outputs_figures/traitglms/prob_all_simple/prob_ocean_trait_many_graph.jpeg"), 
       plot = as.ggplot(prob_ocean_trait_many_graph), width=12, height=12, dpi=300)

```

*GLM1PATH Trait values - Ocean Basin**

Using method = glm1path == LASSO model.

```{r Traits ocean LASSO, eval=FALSE}

prob_ocean_trait_LASSO <- traitglm(L = alb_prob_preyPA_mv,
                                 R = alb_prob_covars$OceanBasin,
                                 Q = traits_use[,1:6],
                                 family=binomial(link = "logit"),
                                 method="glm1path"
                                 ) #note default is "manyglm"

```

```{r Plot traits ocean LASSO, tidy=TRUE, message=FALSE, warning=FALSE}

a        = max( abs(prob_ocean_trait_LASSO$fourth.corner) )
colort   = colorRampPalette(c("blue","grey","red")) #can replace "grey" with "white"
temp = t(as.matrix(prob_ocean_trait_LASSO$fourth.corner))

rownames(temp) = c("Mediterranean",
                   "N Atlantic",
                   "S Atlantic",
                   "N Pacific",
                   "S Pacific",
                   "Indian")

colnames(temp) = c("Prey life: juvenile",
                   "Vert. habitat - benthic",
                   "Vert. habitat - demersal",
                   "Vert. habitat - epipelagic",
                   "Vert. habitat - mesopelagic",
                   "Horz. habitat - coastal",
                   "Horz. habitat - continental shelf",
                   "Horz. habitat - oceanic",
                   "Diel migrant (yes)",
                   "Seasonal migrant (yes)",
                   "Gregarious - schooling")

prob_ocean_LASSO_graph = levelplot(temp, 
                     xlab=list("Ocean Basins", cex=1.5),
                     ylab=list("Species traits", cex=1.5), 
                     col.regions=colort(100), 
                     at=seq(-a, a,length=100),
                     scales = list(x=list(rot = 45, cex=1.3), y=list(cex=1.3)), 
                     colorkey=list(labels=list(cex=1.3)))

print(prob_ocean_LASSO_graph)

ggsave(here("outputs_figures/traitglms/prob_all_simple/prob_ocean_LASSO_graph.pdf"), 
       plot = as.ggplot(prob_ocean_LASSO_graph), width=12, height=12, dpi=300)

ggsave(here("outputs_figures/traitglms/prob_all_simple/prob_ocean_LASSO_graph.jpeg"), 
       plot = as.ggplot(prob_ocean_LASSO_graph), width=12, height=12, dpi=300)

```

#### Climate

**MANYGLM Trait values - Latitude**

Trait (trait matrix)*Env (latitude) - Manyglm

```{r Traits latitude manyglm, eval=FALSE}

prob_lat_trait_many <-  traitglm(L = alb_prob_preyPA_mv,
                            R = alb_prob_covars$lat_cat,
                            Q = traits_use[,1:6],
                            family=binomial(link = "logit")
                            ) #note default is "manyglm"

```

```{r Plot traits latitude manyglm, tidy=TRUE, message=FALSE, warning=FALSE}

a        = max( abs(prob_lat_trait_many$fourth.corner) )
colort   = colorRampPalette(c("blue","grey","red")) #can replace "grey" with "white"
temp = t(as.matrix(prob_lat_trait_many$fourth.corner))

rownames(temp) = c("Tropical")

prob_lat_trait_many_graph = levelplot(temp, 
                     xlab=list("Temperate vs. Tropical", cex=1.5),
                     ylab=list("Species traits", cex=1.5), 
                     col.regions=colort(100), 
                     at=seq(-a, a,length=100),
                     scales = list(x=list(rot = 45, cex=1.3), y=list(cex=1.3)), 
                     colorkey=list(labels=list(cex=1.3)))

print(prob_lat_trait_many_graph)

#ggsave(here("outputs_figures/traitglms/prob_all_simple/prob_lat_trait_many_graph.pdf"), 
#       plot = as.ggplot(prob_lat_trait_many_graph), width=12, height=12, dpi=300)
       
#ggsave(here("outputs_figures/traitglms/prob_all_simple/prob_lat_trait_many_graph.jpeg"), 
#       plot = as.ggplot(prob_lat_trait_many_graph), width=12, height=12, dpi=300)

```

**GLM1PATH Trait values - Latitude**

Using method = glm1path == LASSO model.

```{r Traits latitude LASSO, eval=FALSE}
#levels(alb_prob_covars$lat_cat)

#alb_prob_covars$lat_cat <- factor(alb_prob_covars$lat_cat, levels = c("tropical", "temperate"))

prob_lat_trait_LASSO <-  traitglm(L = alb_prob_preyPA_mv,
                            R = alb_prob_covars$lat_cat,
                            Q = traits_use[,1:6],
                            family=binomial(link = "logit"),
                            method="glm1path"
                            ) #note default is "manyglm"

```

```{r Plot traits latitude LASSO, tidy=TRUE, message=FALSE, warning=FALSE}

a        = max( abs(prob_lat_trait_LASSO$fourth.corner) )
colort   = colorRampPalette(c("blue","grey","red")) #can replace "grey" with "white"
temp = t(as.matrix(prob_lat_trait_LASSO$fourth.corner))

rownames(temp) = c("Temperate")

colnames(temp) = c("Prey life: juvenile",
                   "Vert. habitat - benthic",
                   "Vert. habitat - demersal",
                   "Vert. habitat - epipelagic",
                   "Vert. habitat - mesopelagic",
                   "Horz. habitat - coastal",
                   "Horz. habitat - continental shelf",
                   "Horz. habitat - oceanic",
                   "Diel migrant (yes)",
                   "Seasonal migrant (yes)",
                   "Gregarious - schooling")


prob_lat_trait_LASSO_graph = levelplot(temp, 
                     xlab=list("Temperate vs. Tropical", cex=1.5),
                     ylab=list("Species traits", cex=1.5), 
                     col.regions=colort(100), 
                     at=seq(-a, a,length=100),
                     scales = list(x=list(rot = 45, cex=1.3), y=list(cex=1.3)), 
                     colorkey=list(labels=list(cex=1.3)))

print(prob_lat_trait_LASSO_graph)

#ggsave(here("outputs_figures/traitglms/prob_all_simple/prob_lat_trait_LASSO_temp_graph.pdf"), 
#       plot = as.ggplot(prob_lat_trait_LASSO_graph), width=12, height=12, dpi=300)
       
#ggsave(here("outputs_figures/traitglms/prob_all_simple/prob_lat_trait_LASSO_emp_graph.jpeg"), 
#       plot = as.ggplot(prob_lat_trait_LASSO_graph), width=12, height=12, dpi=300)

```

#### SAVE TRAITS OUTPUTS

```{r SAVE TRAIT MODELS, eval=FALSE}

# Manyglms
saveRDS(prob_life_trait_many, file = here("outputs_figures/traitglms/prob_models/prob_life_trait_many.rds")) 
saveRDS(prob_ocean_trait_many, file = here("outputs_figures/traitglms/prob_models/prob_ocean_trait_many.rds"))
saveRDS(prob_lat_trait_many, file = here("outputs_figures/traitglms/prob_models/prob_lat_trait_many.rds"))

#LASSO glms
saveRDS(prob_life_trait_LASSO, file = here("outputs_figures/traitglms/prob_models/prob_life_trait_LASSO.rds"))
saveRDS(prob_ocean_trait_LASSO, file = here("outputs_figures/traitglms/prob_models/prob_ocean_trait_LASSO.rds"))
saveRDS(prob_lat_trait_LASSO, file = here("outputs_figures/traitglms/prob_models/prob_lat_trait_LASSO.rds"))

```


### Interactions

#### Ocean Basin + Predator Life stage

**MANYGLM Interaction Model**

```{r Traits interactions manyglm, eval=FALSE}

prob_inter_trait_many <- traitglm(L = alb_prob_preyPA_mv,
                                  R = alb_prob_covars[,c(4,12)],
                                  Q = traits_use[,1:6],
                                  family=binomial(link = "logit")
                                    ) #note default is "manyglm"

#prob_inter_trait_many$deviance

```


```{r Plot interactions manyglm, tidy=TRUE, message=FALSE, warning=FALSE}

a        = max( abs(prob_inter_trait_many$fourth.corner) )
colort   = colorRampPalette(c("blue","grey","red")) #can replace "grey" with "white"
temp = t(as.matrix(prob_inter_trait_many$fourth.corner))

prob_inter_trait_many_graph = levelplot(temp, 
                     xlab=list("Predator Life Stage + Ocean Basins", cex=1.5),
                     ylab=list("Species traits", cex=1.5), 
                     col.regions=colort(100), 
                     at=seq(-a, a,length=100),
                     scales = list(x=list(rot = 45, cex=1.3), y=list(cex=1.3)), 
                     colorkey=list(labels=list(cex=1.3)))

print(prob_inter_trait_many_graph)

ggsave(here("outputs_figures/traitglms/prob_all_simple/prob_inter_trait_many_graph.pdf"), 
       plot = as.ggplot(prob_inter_trait_many_graph), width=12, height=12, dpi=300)

ggsave(here("outputs_figures/traitglms/prob_all_simple/prob_inter_trait_many_graph.jpeg"), 
       plot = as.ggplot(prob_inter_trait_many_graph), width=12, height=12, dpi=300)

```

**GLM1PATH Interaction Model**

```{r Traits interactions LASSO, eval=FALSE}

prob_inter_trait_LASSO <- traitglm(L = alb_prob_preyPA_mv,
                                  R = alb_prob_covars[,c(4,12)],
                                  Q = traits_use[,1:6],
                                  family=binomial(link = "logit"),
                                  method="glm1path"
                                    ) #note default is "manyglm"

```

```{r Plot interactions LASSO, tidy=TRUE, message=FALSE, warning=FALSE}

a        = max( abs(prob_inter_trait_LASSO$fourth.corner) )
colort   = colorRampPalette(c("blue","grey","red")) #can replace "grey" with "white"
temp = t(as.matrix(prob_inter_trait_LASSO$fourth.corner))

prob_inter_trait_LASSO_graph = levelplot(temp, 
                     xlab=list("Predator Life Stage + Ocean Basins", cex=1.5),
                     ylab=list("Species traits", cex=1.5), 
                     col.regions=colort(100), 
                     at=seq(-a, a,length=100),
                     scales = list(x=list(rot = 45, cex=1.3), y=list(cex=1.3)), 
                     colorkey=list(labels=list(cex=1.3)))

print(prob_inter_trait_LASSO_graph)

ggsave(here("outputs_figures/traitglms/prob_all_simple/prob_inter_trait_LASSO_graph.pdf"), 
       plot = as.ggplot(prob_inter_trait_LASSO_graph), width=12, height=12, dpi=300)

ggsave(here("outputs_figures/traitglms/prob_all_simple/prob_inter_trait_LASSO_graph.jpeg"), 
       plot = as.ggplot(prob_inter_trait_LASSO_graph), width=12, height=12, dpi=300)

```
#### Ocean Basin + Climate

**MANYGLM Interaction Model**

```{r Traits interactions manyglm 2, eval=FALSE}

prob_inter_trait_many2 <- traitglm(L = alb_prob_preyPA_mv,
                                  R = alb_prob_covars[,c(4,9)],
                                  Q = traits_use[,1:6],
                                  family=binomial(link = "logit")
                                    ) #note default is "manyglm"

#prob_inter_trait_many$deviance

```


```{r Plot interactions manyglm 2, tidy=TRUE, message=FALSE, warning=FALSE}

a        = max( abs(prob_inter_trait_many2$fourth.corner) )
colort   = colorRampPalette(c("blue","grey","red")) #can replace "grey" with "white"
temp = t(as.matrix(prob_inter_trait_many2$fourth.corner))

prob_inter_trait_many2_graph = levelplot(temp, 
                     xlab=list("Predator Life Stage + Climate", cex=1.5),
                     ylab=list("Species traits", cex=1.5), 
                     col.regions=colort(100), 
                     at=seq(-a, a,length=100),
                     scales = list(x=list(rot = 45, cex=1.3), y=list(cex=1.3)), 
                     colorkey=list(labels=list(cex=1.3)))

print(prob_inter_trait_many2_graph)

ggsave(here("outputs_figures/traitglms/prob_all_simple/prob_inter_trait_many2_graph.pdf"), 
       plot = as.ggplot(prob_inter_trait_many2_graph), width=12, height=12, dpi=300)

ggsave(here("outputs_figures/traitglms/prob_all_simple/prob_inter_trait_many2_graph.jpeg"), 
       plot = as.ggplot(prob_inter_trait_many2_graph), width=12, height=12, dpi=300)

```

**GLM1PATH Interaction Model**

```{r Traits interactions LASSO 2, eval=FALSE}

prob_inter_trait_LASSO2 <- traitglm(L = alb_prob_preyPA_mv,
                                  R = alb_prob_covars[,c(4,9)],
                                  Q = traits_use[,1:6],
                                  family=binomial(link = "logit"),
                                  method="glm1path"
                                    ) #note default is "manyglm"

```

```{r Plot interactions LASSO 2, tidy=TRUE, message=FALSE, warning=FALSE}

a        = max( abs(prob_inter_trait_LASSO2$fourth.corner) )
colort   = colorRampPalette(c("blue","grey","red")) #can replace "grey" with "white"
temp = t(as.matrix(prob_inter_trait_LASSO2$fourth.corner))

prob_inter_trait_LASSO2_graph = levelplot(temp, 
                     xlab=list("Predator Life Stage + Climate", cex=1.5),
                     ylab=list("Species traits", cex=1.5), 
                     col.regions=colort(100), 
                     at=seq(-a, a,length=100),
                     scales = list(x=list(rot = 45, cex=1.3), y=list(cex=1.3)), 
                     colorkey=list(labels=list(cex=1.3)))

print(prob_inter_trait_LASSO2_graph)

ggsave(here("outputs_figures/traitglms/prob_all_simple/prob_inter_trait_LASSO2_graph.pdf"), 
       plot = as.ggplot(prob_inter_trait_LASSO2_graph), width=12, height=12, dpi=300)

ggsave(here("outputs_figures/traitglms/prob_all_simple/prob_inter_trait_LASSO2_graph.jpeg"), 
       plot = as.ggplot(prob_inter_trait_LASSO2_graph), width=12, height=12, dpi=300)

```

#### SAVE THESE

```{r Save interaction models, eval=FALSE}

#Manyglm
saveRDS(prob_inter_trait_many, file = here("outputs_figures/traitglms/prob_models/prob_inter_trait_many.rds"))
saveRDS(prob_inter_trait_many2, file = here("outputs_figures/traitglms/prob_models/prob_inter_trait_many2.rds"))

#LASSO glms
saveRDS(prob_inter_trait_LASSO, file = here("outputs_figures/traitglms/prob_models/prob_inter_trait_LASSO.rds"))
saveRDS(prob_inter_trait_LASSO2, file = here("outputs_figures/traitglms/prob_models/prob_inter_trait_LASSO2.rds"))

```


### MODEL COMPARISON

#### Model Outputs

Cluster, trait, spp models each for (i) predator life stage and (ii) ocean basins

##### Model: prob_life_spp

```{r Model Output prob_life_spp}
prob_life_spp
```

```{r Anova prob_life_spp}

#an_prob_life_spp = anova.traitglm(prob_life_spp)
#saveRDS(an_prob_life_spp, file = here("outputs_figures/traitglms/prob_models/an_prob_life_spp.rds"))
an_prob_life_spp = readRDS(file = here("outputs_figures/traitglms/prob_models/an_prob_life_spp.rds"))
an_prob_life_spp

```

##### Model: prob_ocean_spp

```{r Model Output prob_ocean_spp}
prob_ocean_spp
```


```{r Anova prob_ocean_spp}

#an_prob_ocean_spp = anova.traitglm(prob_ocean_spp)
#saveRDS(an_prob_ocean_spp, file = here("outputs_figures/traitglms/prob_models/an_prob_ocean_spp.rds"))
an_prob_ocean_spp = readRDS(file = here("outputs_figures/traitglms/prob_models/an_prob_ocean_spp.rds"))
an_prob_ocean_spp

```

##### Model: prob_lat_spp

```{r Model Output prob_lat_spp}
prob_lat_spp
```

```{r Anova prob_lat_spp}

#an_prob_lat_spp = anova.traitglm(prob_lat_spp)
#saveRDS(an_prob_lat_spp, file = here("outputs_figures/traitglms/prob_models/an_prob_lat_spp.rds"))
an_prob_lat_spp = readRDS(file = here("outputs_figures/traitglms/prob_models/an_prob_lat_spp.rds"))
an_prob_lat_spp

```

##### Model: prob_life_clusters_many

```{r Model Output prob_life_clusters_many}
prob_life_clusters_many
```

```{r Anova prob_life_clusters_many}

#an_prob_life_clusters_many = anova.traitglm(prob_life_clusters_many)
#saveRDS(an_prob_life_clusters_many, file = here("outputs_figures/traitglms/prob_models/an_prob_life_clusters_many.rds"))
an_prob_life_clusters_many = readRDS(file = here("outputs_figures/traitglms/prob_models/an_prob_life_clusters_many.rds"))
an_prob_life_clusters_many



```

##### Model: prob_ocean_clusters_many

```{r Model Output prob_ocean_clusters_many}
prob_ocean_clusters_many
```

```{r Anova prob_ocean_clusters_many}

#an_prob_ocean_clusters_many = anova.traitglm(prob_ocean_clusters_many)
#saveRDS(an_prob_ocean_clusters_many, file = here("outputs_figures/traitglms/prob_models/an_prob_ocean_clusters_many.rds"))
an_prob_ocean_clusters_many = readRDS(file = here("outputs_figures/traitglms/prob_models/an_prob_ocean_clusters_many.rds"))
an_prob_ocean_clusters_many

```

##### Model: prob_lat_clusters_many

```{r Model Output prob_lat_clusters_many}
prob_lat_clusters_many
```
```{r Anova prob_lat_clusters_many}

an_prob_lat_clusters_many = anova.traitglm(prob_lat_clusters_many)
#saveRDS(an_prob_ocean_clusters_many, file = here("outputs_figures/traitglms/prob_models/an_prob_ocean_clusters_many.rds"))
an_prob_ocean_clusters_many = readRDS(file = here("outputs_figures/traitglms/prob_models/an_prob_ocean_clusters_many.rds"))
an_prob_ocean_clusters_many

```


##### Model: prob_life_trait_many

```{r Model Output prob_life_trait_many}
prob_life_trait_many
```

##### Model: prob_ocean_trait_many

```{r Model Output prob_ocean_trait_many}
prob_ocean_trait_many
```

##### Model: prob_lat_trait_many

```{r Model Output prob_lat_trait_many}
prob_lat_trait_many
```


##### Model: prob_inter_trait_many

```{r Model Output: prob_inter_trait_many}
prob_inter_trait_many

prob_inter_trait_many$aic

#prob_inter_trait_many$two.loglike same as deviance explained

prob_inter_trait_many$deviance

prob_inter_trait_many$call


temp = as.data.frame(prob_inter_trait_many$coefficients)


```

##### Model: prob_inter_trait_many2

```{r Model Output: prob_inter_trait_many2}

prob_inter_trait_many2

```

## Conclusions

The species models had the lowest residual deviance explained, and typically higher AIC values.
Cluster models performed slightly better than traits models, but not massive difference. Both cluster and trait sets of models outperformed species models.

The best model in terms of residual deviance explained was the latitude + traits model, however, did have higher AIC scores.
The interaction model that included ocean basin + life stage had the lowest AIC but low deviance explained.

## Remaining to do's

- Run a null model?
- Run latitude + cluster model?

## Model Comp Outputs
Species and environment matrix models - manyglm.

```{r Model list for outputs, eval=FALSE}

#Species*env models
prob_life_spp
prob_ocean_spp
prob_lat_spp

#Cluster*env models (manyglm and LASSO)
#Manyglms
prob_life_clusters_many
prob_ocean_clusters_many
prob_lat_clusters_many
#LASSO glms
prob_life_cluster_LASSO
prob_ocean_cluster_LASSO
prob_lat_cluster_LASSO

#Trait*env models
# Manyglms
prob_life_trait_many 
prob_ocean_trait_many
prob_lat_trait_many
#LASSO glms
prob_life_trait_LASSO
prob_ocean_trait_LASSO
prob_lat_trait_LASSO 

#Additive multi-variable env models
#Manyglm
prob_inter_trait_many
prob_inter_trait_many2
#LASSO glms
prob_inter_trait_LASSO
prob_inter_trait_LASSO2
```

**Note**

- Could add additive models, LASSO models?

```{r Make output dataframe, eval=FALSE}

model = c("prob_life_spp", "prob_ocean_spp", "prob_lat_spp", 
          "prob_life_trait_many", "prob_ocean_trait_many", "prob_lat_trait_many",
          "prob_life_clusters_many", "prob_ocean_clusters_many", "prob_lat_clusters_many") 
#,        "prob_inter_trait_many", "prob_inter_trait_many2"
mod_type = c("species", "species", "species", 
             "traits", "traits", "traits",
             "cluster", "cluster", "cluster")
#,           "trait*ocean*life stage", "trait*ocean*climate"
covar = c("predator life stage", "ocean basin", "climate",
          "predator life stage", "ocean basin", "climate",
          "predator life stage", "ocean basin", "climate")
#,        "ocean*life stage", "ocean*climate"
deviance = c(prob_life_spp$deviance, prob_ocean_spp$deviance, prob_lat_spp$deviance,
             prob_life_trait_many$deviance, prob_ocean_trait_many$deviance, prob_lat_trait_many$deviance,
             prob_life_clusters_many$deviance, prob_ocean_clusters_many$deviance, prob_lat_clusters_many$deviance)
#,           prob_inter_trait_many$deviance, prob_inter_trait_many2$deviance
aic = c(prob_life_spp$AICsum, prob_ocean_spp$AICsum, prob_lat_spp$AICsum,
        prob_life_trait_many$AICsum, prob_ocean_trait_many$AICsum, prob_lat_trait_many$AICsum,
        prob_life_clusters_many$AICsum, prob_ocean_clusters_many$AICsum, prob_lat_clusters_many$AICsum)
#,      prob_inter_trait_many$AICsum, prob_inter_trait_many2$AICsum
mod_dev = data.frame(covar, mod_type, model, deviance, aic)

write.csv(mod_dev, here("data/output_data/mod_dev.csv"))
```

```{r Make output graph}
mod_dev$mod_type = as.factor(mod_dev$mod_type)
mod_dev$mod_type = factor(mod_dev$mod_type, levels = c("species", "trait", "cluster"))
levels(mod_dev$mod_type)

#mod_dev_graph = ggplot(data = mod_dev, aes(x = model, y = deviance, color = covar)) + 
#  geom_bar(stat = "identity", width = 1) + 
#  facet_grid(.~ mod_type)

mod_dev_graph = ggplot(data = mod_dev) + 
  geom_bar(aes(y = deviance, fill = mod_type)) +
  theme_classic() +
  theme(axis.title = element_text(size=20),
        axis.text = element_text(size=20),
        axis.text.x = element_blank(),
        axis.ticks = element_blank(),
        legend.text = element_text(size=20),
        legend.title = element_text(size=20),
        legend.position = "top") +
  xlab("Covariate fitted to model") + ylab("Deviance explained") + 
  scale_fill_viridis_d(option="D", begin = 0.2, end = 0.9, name = "Model type")+
  facet_grid(.~ covar)

mod_dev_graph

ggsave(here("outputs_figures/traitglms/prob_all_simple/mod_dev_graph2.pdf"), 
       plot = mod_dev_graph, width=5, height=4, dpi=300)

ggsave(here("outputs_figures/traitglms/prob_all_simple/mod_dev_graph2.jpeg"), 
       plot = mod_dev_graph, width=5, height=4, dpi=300)

```

